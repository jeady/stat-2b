function Stici_HistHiLite(e,t){function r(){function f(e){if(null===n.restrictedCounts||!n.showingRestricted.is(":checked"))return d3.select(e.get(0)).append("svg").attr("height","100%").selectAll("div").data(n.binCounts).enter().append("rect").attr("y",function(e){return i-e/u}).attr("height",function(e){return e/u}).attr("x",function(e,t){return r*(n.binEnds[t]-n.binEnds.min())/s}).attr("width",function(e,t){return r*(n.binEnds[t+1]-n.binEnds[t])/s});var t=d3.select(e.get(0)).append("svg").attr("height","100%").selectAll("div"),o=jQuery.map(n.binCounts,function(e,t){return n.showingOriginal.is(":checked")?[[n.binCounts[t],n.restrictedCounts[t]]]:[[null,n.restrictedCounts[t]]]});return t.data(o).enter().append("rect").attr("y",function(e){return i-e.max()/u}).attr("height",function(e){return e.max()/u}).attr("x",function(e,t){return r*(n.binEnds[t]-n.binEnds.min())/s}).attr("width",function(e,t){return r*(n.binEnds[t+1]-n.binEnds[t])/s}).attr("class",function(e){return e[0]==e[1]?"restricted":e[1]>e[0]?"restricted":""}),t.data(o).enter().append("rect").attr("y",function(e){return i-e.min()/u}).attr("height",function(e){return e.min()/u}).attr("x",function(e,t){return r*(n.binEnds[t]-n.binEnds.min())/s}).attr("width",function(e,t){return r*(n.binEnds[t+1]-n.binEnds[t])/s}).attr("class",function(e){return e[0]==e[1]?"":e[1]<e[0]?"restricted":""}),t}var e;n.chartDiv.children().remove();var t=jQuery("<div/>").addClass("chart_box");n.overlayDiv=t.clone().addClass("overlay"),n.normalOverlayDiv=jQuery("<div/>").addClass("chart_box"),n.chartDiv.append(t),n.chartDiv.append(n.overlayDiv),n.chartDiv.append(n.normalOverlayDiv);var r=n.overlayDiv.width(),i=n.overlayDiv.height(),s=n.binEnds.max()-n.binEnds.min(),o=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.nBins]-n.binEnds[0])/(r-1),i=normPdf(n.mu,n.sd,t);return i},u=null;for(e=0;e<r;e++)(u===null||o(e)>u)&&!isNaN(o(e))&&(u=o(e));u=Math.max(n.binCounts.max(),u);var a=null;if(null!==n.restrictedCounts){a=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.nBins]-n.binEnds[0])/(r-1),i=normPdf(n.restrictedMu,n.restrictedSd,t);return i};for(e=0;e<r;e++)(u===null||a(e)>u)&&!isNaN(a(e))&&(u=a(e));u=Math.max(n.restrictedCounts.max(),u)}u/=i-1,f(t),f(n.overlayDiv),n.overlayDiv.css("clip","rect(0px, 0px, "+i+"px, 0px)");var l=d3.select(t.get(0)).append("svg").attr("class","axis"),h=d3.scale.linear().domain([n.binEnds.min(),n.binEnds.max()]).range([0,r]),p=d3.svg.axis().scale(h).orient("bottom");l.append("g").call(p);if(n.options.showNormalButton||n.options.showNormal){var d=d3.svg.line().x(function(e){return e}).y(function(e){return i-o(e)/u}),v=d3.select(n.normalOverlayDiv.get(0)).append("svg").attr("height","100%");if(null===n.restrictedCounts||n.showingOriginal.is(":checked")||!n.showingRestricted.is(":checked")){var m=v.append("path");null!==n.restrictedCounts&&m.attr("class","nrestricted"),m.data([d3.range(0,r)]).attr("d",d)}if(null!==n.restrictedCounts&&n.showingRestricted.is(":checked")){var g=d3.svg.line().x(function(e){return e}).y(function(e){return i-a(e)/u});v.append("path").attr("class","restricted").data([d3.range(0,r)]).attr("d",g)}n.showingNormal?n.showNormalButton.text("Hide Normal Curve"):(n.showNormalButton.text("Show Normal Curve"),n.normalOverlayDiv.hide())}c()}function i(e){n.dataSource=n.dataSelect.val(),jQuery.getJSON(n.dataSource,function(t){n.dataFields=t[0],n.dataValues=t.slice(1),n.variableSelect.children().remove(),jQuery.each(n.dataFields,function(e,t){if(t.indexOf("//")===0)return;n.variableSelect.append(jQuery("<option/>").attr("value",e).text(t))}),n.variableSelect.val(2),s(),n.reloadChart(),e&&e()})}function s(){n.data=jQuery.map(n.dataValues,function(e){return parseFloat(e[n.variableSelect.val()])}),n.binEnds=histMakeBins(n.nBins,n.data),n.binCounts=histMakeCounts(n.binEnds,n.data),n.sd=sd(n.data),n.mu=mean(n.data);var e="n="+n.data.length;e+="&nbsp;&nbsp;&nbsp;",e+="Mean="+n.mu.toFixed(3),e+="&nbsp;&nbsp;&nbsp;",e+="SD="+n.sd.toFixed(3),n.additionalInfo.html(e)}function o(){n.data=[n.options.ends.min(),n.options.ends.max()],n.options.sd===null?n.sd=sd(n.data):n.sd=n.options.sd,n.options.mu===null?n.mu=mean(n.data):n.mu=n.options.mu,n.binEnds=n.options.ends,n.binCounts=n.options.counts;var e=n.binCounts.reduce(function(e,t){return e+t});for(var t=0;t<n.binCounts.length;t++)n.binCounts[t]/=e*(n.binEnds[t+1]-n.binEnds[t]);n.reloadChart()}function u(){var e=n.p,t=n.n;n.nBins=t+1,n.binCounts=[Math.pow(1-e,t)],n.binEnds=[-0.5];for(var r=1;r<n.nBins;r++)e<1?n.binCounts.push(n.binCounts[r-1]*e*(t-r+1)/((1-e)*r)):n.binCounts.push(0),n.binEnds.push(r-.5);n.binEnds.push(t+.5),e==1&&(n.binCounts[n.nBins-1]=1),n.sd=Math.sqrt(t*e*(1-e)),n.mu=t*e,n.reloadChart(),n.options.binomialBars||n.additionalInfo.html("n="+t+"&nbsp;&nbsp;&nbsp;p="+e)}function a(){function h(e){t.append(e),u+=o}function p(e){i.append(e),a+=o}function d(){var e=jQuery("<div/>").addClass("popbox"),t=jQuery("<button/>").addClass("open").text("Click Here!"),n=jQuery("<div/>").addClass("collapse");n.html('<div class="box">  <div class="arrow"></div>  <div class="arrow-border"></div>  <div class="popbox-content">  </div>  <a href="#" class="close">close</a></div>'),e.append(t).append(n);var r=n.find(".popbox-content");return r.text("Content Here :)"),e.data("onPopBox",function(){e.find(".viewport").parent().width(r.width()+20)}),{parent:e,button:t,content:r}}function v(){n.urlInput=jQuery('<input type="text" />'),n.dataSelect=jQuery("<select/>").change(n.reloadData),n.variableSelect=jQuery("<select/>").change(function(){s(),n.options.restrict&&l(),n.reloadChart()});var e=jQuery("<div/>");e.append("Data: "),n.options.data.length>1?e.append(n.dataSelect):(e.append(n.options.data[0].replace(/^.*[\\\/]/,"")),e.append("&nbsp;&nbsp;&nbsp;")),jQuery.each(n.options.data,function(e,t){n.dataSelect.append(jQuery("<option/>").attr("value",t).text(t.replace(/^.*[\\\/]/,"")))}),e.append("Variable: ").append(n.variableSelect),n.options.restrict&&(n.showingOriginal=jQuery('<input type="checkbox" />'),n.showingOriginal.prop("checked",!0),n.showingOriginal.change(function(){r()}),e.append(n.showingOriginal).append("Show original data"),n.showingRestricted=jQuery('<input type="checkbox" />'),n.showingRestricted.prop("checked",!0),n.showingRestricted.change(function(){r()}),e.append(n.showingRestricted).append("Show restricted data")),h(e)}function m(){var e=jQuery("<div/>").addClass("areaHiLite");n.areaFromInput=jQuery('<input type="text" />').change(function(){n.areaFromSlider.slider("value",n.areaFromInput.val())});var t=function(){n.areaFromInput.val(n.areaFromSlider.slider("value")),c()};n.areaFromSlider=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:n.dataIsBinomial?1:.001}),e.append("Area from: ").append(n.areaFromInput).append(n.areaFromSlider),n.areaToInput=jQuery('<input type="text" />').change(function(){n.areaToSlider.slider("value",n.areaToInput.val())});var i=function(){n.areaToInput.val(n.areaToSlider.slider("value")),c()};n.areaToSlider=jQuery("<span/>").addClass("slider").slider({change:i,slide:i,step:n.dataIsBinomial?1:.001}),e.append(" to: ").append(n.areaToInput).append(n.areaToSlider);if(n.options.changeNumBins){var s=jQuery('<input type="text" />').val(n.options.bins);s.change(function(){n.nBins=parseInt(s.val(),10),n.binEnds=histMakeBins(n.nBins,n.data),n.binCounts=histMakeCounts(n.binEnds,n.data),n.options.restrict&&l(),r()}),e.append("Bins: ").append(s)}else n.dataIsBinomial||e.append("Bins: "+n.options.bins);p(e)}function g(){var e=jQuery("<div/>");n.restrictedVariable=n.variableSelect.clone(),n.restrictedVariable.change(function(){f(),l()}),e.append("Restrict to ").append(n.restrictedVariable),n.restrictLowerEnable=jQuery('<input type="checkbox" />'),e.append(n.restrictLowerEnable).append(">= "),n.restrictLower=jQuery('<input type="text" />'),e.append(n.restrictLower),n.restrictUpperEnable=jQuery('<input type="checkbox" />'),e.append(n.restrictUpperEnable).append("and <= "),n.restrictUpper=jQuery('<input type="text" />'),e.append(n.restrictUpper),jQuery.each([n.restrictLowerEnable,n.restrictLower,n.restrictUpperEnable,n.restrictUpper],function(e,t){t.change(l)});var t=jQuery("<button/>").text("Clear Restrictions");t.click(function(e){e.preventDefault(),n.restrictUpperEnable.prop("checked",!1),n.restrictUpper.val(n.binEnds.max()),n.restrictLowerEnable.prop("checked",!1),n.restrictLower.val(n.binEnds.min()),l()}),e.append(" ").append(t),p(e)}function y(){var e=jQuery("<div/>"),t=null,r=d();r.button.text("List Data"),r.button.click(function(e){e.preventDefault();var t=n.dataFields,i=n.dataValues,s=t.length,o,u,a,f;f='<div class="table-container"><div class="table-header"><table class="data-fields"><thead><tr>';for(var l=0;l<t.length;l++)f+="<td>"+t[l]+"</td>";f+="</tr></thead></table></div>",f+='<div class="table-body"><table class="data-values"><tbody>';for(var c=0;c<i.length;c++){o=i[c],o.length>t.length&&(a=o.slice(t.length-1).join(" ").replace(/[\/]/g,""),o=o.slice(0,t.length-1),o.push(a)),f+='<tr data-index="'+c+'">';for(var h=0;h<o.length;h++)u=o[h],f+="<td>"+u+"</td>";f+="</tr>"}f+="</tbody></table></div></div>",r.content.html(f),r.content.find("table").css("width",n.dataFields.length*120+"px")}),n.options.listData&&e.append(r.parent);var i=d();i.button.text("Univariate Stats"),i.button.click(function(e){e.preventDefault();var t='<div class="univariate-stats-container">';$.each(n.dataFields,function(e){if(n.dataFields[e].indexOf("//")===0)return;t+='<div class="univariate-stat-wrapper"><h3>'+n.dataFields[e]+"</h3>";var r=$.map(n.dataValues,function(t){return parseFloat(t[e])});t+='<ul class="stat-list"><li class="stat-item">Cases: '+r.length+"</li>"+'<li class="stat-item">Mean: '+mean(r).toFixed(2)+"</li>"+'<li class="stat-item">SD: '+sd(r).toFixed(2)+"</li>"+'<li class="stat-item">Min: '+r.min().toFixed(2)+"</li>"+'<li class="stat-item">LQ: '+percentile(r,25).toFixed(2)+"</li>"+'<li class="stat-item">Median: '+percentile(r,50).toFixed(2)+"</li>"+'<li class="stat-item">UQ: '+percentile(r,75).toFixed(2)+"</li>"+'<li class="stat-item">Max: '+r.max().toFixed(2)+"</li>"+"</ul>",t+="</div>"}),t+="</div>",i.content.html(t)}),n.options.showUnivariateStats&&e.append(i.parent),n.showNormalButton=jQuery("<button/>").addClass("open"),n.showingNormal?n.showNormalButton.text("Hide Normal Curve"):n.showNormalButton.text("Show Normal Curve"),n.showNormalButton.click(function(e){e.preventDefault(),n.normalOverlayDiv.toggle(),n.showingNormal?n.showNormalButton.text(n.showNormalButton.text().replace("Hide","Show")):n.showNormalButton.text(n.showNormalButton.text().replace("Show","Hide")),n.showingNormal=!n.showingNormal,c()}),n.options.showNormalButton&&e.append(n.showNormalButton),e.children().length>0&&p(e)}function b(){var e=jQuery("<div/>").addClass("binomialBars"),t=function(){s.val(o.slider("value")),r.val(i.slider("value")),n.n=parseFloat(r.val()),n.p=parseFloat(s.val()),n.reloadData()},r=jQuery('<input type="text" />').change(function(){i.slider("value",r.val())}).val(n.n),i=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:1,min:1,max:500,value:n.n});e.append("n: ").append(r).append(i);var s=jQuery('<input type="text" />').change(function(){o.slider("value",s.val())}).val(n.p),o=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:.001,min:0,max:1,value:n.p});e.append("p: ").append(s).append(o),p(e)}var e=jQuery("<div/>").addClass("stici").addClass("stici_histogram");n.container.append(e);var t=jQuery("<div/>").addClass("top_controls");e.append(t),n.chartDiv=jQuery("<div/>").addClass("stici_chart").addClass("chart_box"),e.append(n.chartDiv),n.areaInfoDiv=jQuery("<div/>").addClass("area_info"),e.append(n.areaInfoDiv);var i=jQuery("<div/>").addClass("bottom_controls");e.append(i);var o=30,u=0,a=0;n.dataSource!==null&&v(),m(),n.options.restrict&&g(),n.options.binomialBars&&b(),y();var w=jQuery("<div/>").addClass("additional_info");n.additionalInfo=jQuery("<p/>"),w.append(n.additionalInfo),(!n.dataIsBinomial||!n.options.binomialBars)&&p(w),jQuery(".popbox").popbox(),n.areaInfoDiv.css("bottom",a+"px"),t.css("height",u+"px"),i.css("height",a+"px"),n.chartDiv.css("margin-bottom",a+15+"px"),n.chartDiv.css("margin-top",u+"px")}function f(){if(!n.options.restrict)return;var e=n.restrictedStates[n.restrictedVariable.val()];n.restrictUpperEnable.prop("checked",e.upperEnable),n.restrictUpper.val(e.upper),n.restrictLowerEnable.prop("checked",e.lowerEnable),n.restrictLower.val(e.lower)}function l(){var e=n.restrictedStates[n.restrictedVariable.val()];e.upperEnable=n.restrictUpperEnable.prop("checked"),e.upper=n.restrictUpper.val(),e.lowerEnable=n.restrictLowerEnable.prop("checked"),e.lower=n.restrictLower.val(),n.restrictedStates[n.restrictedVariable.val()]=e;var t="n="+n.data.length;t+="&nbsp;&nbsp;&nbsp;",t+="Mean="+n.mu.toFixed(3),t+="&nbsp;&nbsp;&nbsp;",t+="SD="+n.sd.toFixed(3),n.restrictedData=jQuery.map(n.dataValues,function(e){return[[parseFloat(e[n.variableSelect.val()]),parseFloat(e[n.restrictedVariable.val()])]]}),n.restrictUpperEnable.is(":checked")&&(n.restrictedData=jQuery.grep(n.restrictedData,function(e){return e[1]<=n.restrictUpper.val()?!0:!1})),n.restrictLowerEnable.is(":checked")&&(n.restrictedData=jQuery.grep(n.restrictedData,function(e){return e[1]>=n.restrictLower.val()?!0:!1})),n.restrictedData=jQuery.map(n.restrictedData,function(e){return e[0]}),!n.restrictUpperEnable.is(":checked")&&!n.restrictLowerEnable.is(":checked")?n.restrictedCounts=null:(n.restrictedCounts=histMakeCounts(n.binEnds,n.restrictedData),isNaN(n.restrictedCounts[0])&&(n.restrictedCounts=null),n.restrictedMu=mean(n.restrictedData),n.restrictedSd=sd(n.restrictedData),t+="&nbsp;&nbsp;&nbsp;",t+="Subset: n="+n.restrictedData.length,t+="&nbsp;&nbsp;&nbsp;",t+="Mean="+n.restrictedMu.toFixed(3),t+="&nbsp;&nbsp;&nbsp;",t+="SD="+n.restrictedSd.toFixed(3)),n.additionalInfo.html(t),r()}function c(){var e=parseFloat(n.areaFromSlider.slider("value")),t=parseFloat(n.areaToSlider.slider("value")),r=n.chartDiv.width()/(n.binEnds.max()-n.binEnds.min()),i=(e-n.binEnds.min())*r,s=(t-n.binEnds.min())*r;n.overlayDiv.css("clip","rect(0px,"+s+"px,"+n.chartDiv.height()+"px,"+i+"px)");var o=histHiLitArea(e,t,n.binEnds,n.binCounts);o*=100;var u="Selected area: "+o.fix(2)+"%";if(n.showingNormal){var a=n.mu,f=n.sd;o=Math.max(0,(normCdf((t-a)/f)-normCdf((e-a)/f))*100),u+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",u+="Normal approx: "+o.fix(2)+"%"}n.restrictedCounts!==null&&(u+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",o=histHiLitArea(e,t,n.binEnds,n.restrictedCounts),o*=100,u+="Subset data: "+o.fix(2)+"%",n.showingNormal&&(rm=n.restrictedMu,rs=n.restrictedSd,o=Math.max(0,(normCdf((t-rm)/rs)-normCdf((e-rm)/rs))*100),u+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",u+="Normal approx: "+o.fix(2)+"%")),n.areaInfoDiv.html(u)}var n=this;if(!t instanceof Object){console.error("Stici_HistHiLite params should be an object");return}this.options={showNormalButton:!0,showNormal:!1,bins:10,changeNumBins:!0,showUnivariateStats:!0,hiLiteHi:null,hiLiteLo:null,data:null,listData:!0,restrict:!1,counts:null,ends:null,n:null,p:null,binomialBars:!0},jQuery.each(t,function(e){typeof n.options[e]=="undefined"&&console.warn("Stici_HistHiLite: Unknown key '"+e+"'")}),jQuery.extend(this.options,t),this.container=jQuery("#"+e),this.dataFields=null,this.dataValues=null,this.dataSource=null,this.data=null,this.restrictedData=null,this.nBins=n.options.bins,this.binEnds=null,this.binCounts=null,this.restrictedCounts=null,this.sd=0,this.mu=0,this.restrictedSd=0,this.restrictedMu=0,this.n=n.options.n,this.p=n.options.p,this.urlInput=null,this.dataSelect=null,this.variableSelect=null,this.chartDiv=null,this.overlayDiv=null,this.normalOverlayDiv=null,this.areaFromInput=null,this.areaFromSlider=null,this.areaToInput=null,this.areaToSlider=null,this.areaInfoDiv=null,this.showNormalButton=null,this.showingOriginal=null,this.showingRestricted=null,this.additionalInfo=null,this.restrictedVariable=null,this.restrictLowerEnable=null,this.restrictLower=null,this.restrictUpperEnable=null,this.restrictUpper=null,this.restrictedStates={},this.dataIsBinomial=!1,this.dataIsManual=!1,this.dataIsExternal=!1,this.reloadData=null;if(n.options.n!==null||n.options.p!==null)n.dataIsBinomial=!0,n.options.showUnivariateStats=!1,n.options.listData=!1,n.options.changeNumBins=!1,n.reloadData=u;else if(n.options.counts!==null||n.options.ends!==null)n.dataIsManual=!0,n.dataSource=null,t.showNormal||(n.options.showNormal=!1),t.showNormalButton||(n.options.showNormalButton=!1),n.options.showUnivariateStats=!1,n.options.listData=!1,n.options.changeNumBins=!1,n.options.binomialBars=!1,n.reloadData=o;else{if(!(n.options.data instanceof Array)){console.error("Unknown data source.");return}n.dataIsExternal=!0,n.dataSource=n.options.data[0],n.options.binomialBars=!1,n.options.restrict?n.reloadData=function(){i(function(){n.restrictedVariable.html(""),n.restrictedStates={},jQuery.each(n.dataFields,function(e,t){if(t.indexOf("//")===0)return;var r=jQuery.map(n.dataValues,function(t){return parseFloat(t[e])});n.restrictedStates[e]={lower:r.min(),lowerEnable:!1,upper:r.max(),upperEnable:!1}}),n.restrictedVariable.html(n.variableSelect.html()),n.restrictedVariable.val((parseInt(n.variableSelect.val(),10)+1)%n.variableSelect.children().length),f(),l()})}:n.reloadData=i}this.showingNormal=n.options.showNormal,this.reloadChart=function(){r(),n.areaFromSlider.slider("option","min",n.binEnds.min()),n.areaFromSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteLo===null?(n.areaFromSlider.slider("option","value",n.binEnds.min()),n.areaFromInput.val(n.binEnds.min())):(n.areaFromSlider.slider("option","value",n.options.hiLiteLo),n.areaFromInput.val(n.options.hiLiteLo)),n.areaToSlider.slider("option","min",n.binEnds.min()),n.areaToSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteHi===null?(n.areaToSlider.slider("option","value",n.binEnds.min()),n.areaToInput.val(n.binEnds.min())):(n.areaToSlider.slider("option","value",n.options.hiLiteHi),n.areaToInput.val(n.options.hiLiteHi)),n.dataIsBinomial&&(n.areaToSlider.slider("value",.5+Math.floor(n.areaToSlider.slider("value"))),n.areaFromSlider.slider("value",.5+Math.floor(n.areaFromSlider.slider("value"))))},a(),this.reloadData()}function Stici_NormHiLite(e,t){function r(){function u(e){var t=e/r*o+n.distribution.lo();return n.distribution.y(t)}n.areaFromSlider.slider("option","min",n.distribution.lo()),n.areaFromSlider.slider("option","max",n.distribution.hi()),n.areaToSlider.slider("option","min",n.distribution.lo()),n.areaToSlider.slider("option","max",n.distribution.hi());var e;n.chartDiv.children().remove();var t=jQuery("<div/>").addClass("chart_box");n.overlayDiv=t.clone().addClass("overlay"),n.normalOverlayDiv=jQuery("<div/>").addClass("chart_box"),n.chartDiv.append(t),n.chartDiv.append(n.overlayDiv),n.chartDiv.append(n.normalOverlayDiv);var r=n.overlayDiv.width(),i=n.overlayDiv.height(),o=n.distribution.hi()-n.distribution.lo(),a=0;for(e=0;e<r;e++)a=Math.max(a,u(e));a/=i-1;var f=d3.svg.line().x(function(e){return e}).y(function(e){return i-u(e)/a});d3.select(t.get(0)).append("svg").attr("height","100%").append("path").data([d3.range(0,r)]).attr("d",f);var l=d3.svg.line().x(function(e,t){return e}).y(function(e,t){return t===0||t==r+1?i:i-u(e)/a}),c=[0].concat(d3.range(0,r),[r]);d3.select(n.overlayDiv.get(0)).append("svg").attr("height","100%").append("path").data([c]).attr("d",l),n.overlayDiv.css("clip","rect(0px, 0px, "+i+"px, 0px)");var h=d3.select(t.get(0)).append("svg").attr("class","axis"),p=d3.scale.linear().domain([n.distribution.lo(),n.distribution.hi()]).range([0,r]),d=d3.svg.axis().scale(p).orient("bottom");h.append("g").call(d),s()}function i(){function f(e){t.append(e),u+=o}function l(e){i.append(e),a+=o}function c(){var e=jQuery("<div/>");n.areaFromInput=jQuery('<input type="text" />').change(function(){n.areaFromSlider.slider("value",n.areaFromInput.val())});var t=function(){n.areaFromInput.val(n.areaFromSlider.slider("value")),s()};n.areaFromSlider=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:.001}),e.append("Lower endpoint: ").append(n.areaFromInput).append(n.areaFromSlider),n.areaToInput=jQuery('<input type="text" />').change(function(){n.areaToSlider.slider("value",n.areaToInput.val())});var r=function(){n.areaToInput.val(n.areaToSlider.slider("value")),s()};n.areaToSlider=jQuery("<span/>").addClass("slider").slider({change:r,slide:r,step:.001}),e.append(" Upper endpoint: ").append(n.areaToInput).append(n.areaToSlider),l(e)}function h(){var e=jQuery("<div/>");dfInput=jQuery('<input type="text" />').change(function(){dfSlider.slider("value",dfInput.val())});var t=function(){n.df=dfSlider.slider("value"),dfInput.val(dfSlider.slider("value")),r(),s()};dfSlider=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:1,min:1,max:350}),e.append(" Degrees of Freedom: ").append(dfInput).append(dfSlider),dfSlider.slider("value",n.df),l(e)}var e=jQuery("<div/>").addClass("stici").addClass("stici_normhilite");n.container.append(e);var t=jQuery("<div/>").addClass("top_controls");e.append(t),n.chartDiv=jQuery("<div/>").addClass("stici_chart").addClass("chart_box"),e.append(n.chartDiv),n.areaInfoDiv=jQuery("<div/>").addClass("area_info"),e.append(n.areaInfoDiv);var i=jQuery("<div/>").addClass("bottom_controls");e.append(i);var o=30,u=0,a=0;c(),n.options.distribution!="normal"&&h();var p=jQuery("<div/>").addClass("additional_info");n.additionalInfo=jQuery("<p/>"),p.append(n.additionalInfo),l(p),n.areaInfoDiv.css("bottom",a+"px"),t.css("height",u+"px"),i.css("height",a+"px"),n.chartDiv.css("margin-bottom",a+15+"px"),n.chartDiv.css("margin-top",u+"px")}function s(){var e=parseFloat(n.areaFromSlider.slider("value")),t=parseFloat(n.areaToSlider.slider("value")),r=n.chartDiv.width()/(n.distribution.hi()-n.distribution.lo()),i=(e-n.distribution.lo())*r,s=(t-n.distribution.lo())*r;n.overlayDiv.css("clip","rect(0px,"+s+"px,"+n.chartDiv.height()+"px,"+i+"px)");var o=n.distribution.area(e,t);o*=100;var u="Selected area: "+o.fix(2)+"%";n.areaInfoDiv.html(u)}var n=this;if(!t instanceof Object){console.error("Stici_NormHiLite params should be an object");return}this.options={distribution:"normal",mean:0,SD:1,df:2,hiLiteLo:0,hiLiteHi:0},jQuery.each(t,function(e){typeof n.options[e]=="undefined"&&console.warn("Stici_NormHiLite: Unknown key '"+e+"'")}),jQuery.extend(this.options,t),this.container=jQuery("#"+e),this.df=n.options.df,this.distribution=null;if(this.options.distribution=="normal")this.distribution={lo:function(){return-5},hi:function(){return 5},y:function(e){return normPdf(n.options.mean,n.options.SD,e)},area:function(e,t){return normCdf(t)-normCdf(e)}};else if(this.options.distribution=="Student-t")this.distribution={lo:function(){return-6},hi:function(){return 6},y:function(e){return tPdf(n.df,e)},area:function(e,t){return tCdf(n.df,t)-tCdf(n.df,e)}};else{if(this.options.distribution!="chi-square"){console.error("Stici_NormHiLite: Unknown distribution specified."),this.container.text("Unknown distributions specified.");return}this.distribution={lo:function(){return 0},hi:function(){return 6*n.df},y:function(e){return chi2Pdf(n.df,e)},area:function(e,t){return chi2Cdf(n.df,t)-chi2Cdf(n.df,e)}}}this.chartDiv=null,this.overlayDiv=null,this.normalOverlayDiv=null,this.areaFromInput=null,this.areaFromSlider=null,this.areaToInput=null,this.areaToSlider=null,this.areaInfoDiv=null,this.additionalInfo=null,this.reloadChart=function(){r(),n.options.hiLiteLo===null?(n.areaFromSlider.slider("option","value",n.distribution.lo()),n.areaFromInput.val(n.distribution.lo())):(n.areaFromSlider.slider("option","value",n.options.hiLiteLo),n.areaFromInput.val(n.options.hiLiteLo)),n.options.hiLiteHi===null?(n.areaToSlider.slider("option","value",n.distribution.lo()),n.areaToInput.val(n.distribution.lo())):(n.areaToSlider.slider("option","value",n.options.hiLiteHi),n.areaToInput.val(n.options.hiLiteHi))},i(),this.reloadChart()}function Stici_SampleDist(e,t){function m(){b(),T(),x(),g()}function g(){n.options.statisticType==s?(n.mu=n.popMean,n.sd=n.popSd):n.options.statisticType==r?(n.mu=n.popMean*n.options.sampleSize,n.sd=n.popSd):n.options.statisticType==a?(n.options.withReplacement?n.mu=n.popSd*n.popSd:n.mu=n.mu*n.options.population.length/(n.options.population.length-1),n.sd=Math.sqrt(2/(n.options.sampleSize-1))*n.popSd*n.popSd):n.options.statisticType==u?(n.mu=n.options.population.length-1,n.sd=Math.sqrt(2*(n.options.population.length-1))):n.options.statisticType==o&&(n.mu=0,n.options.sampleSize>2?n.sd=n.options.sampleSize/(n.options.sampleSize-2):n.sd=NaN)}function y(){n.options.statisticType==u?n.popTextLabel="Category Probabilities":n.popTextLabel="Population",n.options.populationType==f&&(n.options.boxContents=n.options.population.join("\n"))}function b(){n.options.populationType==f?pop=n.options.population:n.options.populationType==c?pop=[-4,4]:n.options.populationType==l&&(pop=[0,1]),n.popMin=pop.min(),n.popMax=pop.max(),nPop=n.options.population.length,n.options.populationType==f?(n.popMean=mean(n.options.population),n.popSd=sd(n.options.population)):n.options.populationType==c?(n.popMean=0,n.popSd=1):n.options.populationType==l&&(n.popMean=.5,n.popSd=Math.sqrt(1/12))}function w(){var e=[];for(var t=0;t<n.options.bins;t++)midPt=(n.binEnds[t]+n.binEnds[t+1])/2,midPt>=0&&midPt<=1&&e.push(midPt);return e}function E(){var e=[];for(var t=0;t<n.options.bins;t++){count=(normCdf(n.binEnds[t+1])-normCdf(n.binEnds[t]))/(n.binEnds[t+1]-n.binEnds[t]),count=Math.round(count*100);while(count>0)e.push(n.binEnds[t]),count--}return e}function S(){return jQuery("#population").val().split("\n").map(function(e){return parseFloat(e,10)}).filter(function(e){return!isNaN(e)})}function x(){var e=[];n.options.populationType==f?e=S():n.options.populationType==l?e=w():n.options.populationType==c&&(e=E()),n.options.population=e}function T(){b();if(n.options.statisticType==r)n.xMin=n.options.sampleSize*n.popMin,n.xMax=n.options.sampleSize*n.popMax;else if(n.options.statisticType==u)n.xMin=0,n.xMax=10*Math.sqrt(n.options.population.length-1);else if(n.options.statisticType==a){n.xMin=0;var e=Math.max(n.popMean-n.popMin,n.popMax-n.popMean);n.xMax=3*e*e/Math.sqrt(n.options.sampleSize)}else n.options.statisticType==s?(n.xMin=-0.1,n.xMax=(n.popMax+4*n.popSd)/Math.sqrt(n.options.sampleSize)):n.options.statisticType==o&&(n.options.sampleSize>2?(n.xMin=-3*Math.sqrt((n.options.sampleSize+0)/(n.options.sampleSize-2)),n.xMax=3*Math.sqrt((n.options.sampleSize+0)/(n.options.sampleSize-2))):(n.xMin=-5,n.xMax=5));n.showPopulationButton&&(n.xMin=Math.min(n.popMin,n.xMin),n.xMax=Math.max(n.popMax,n.xMax)),n.binEnds=histMakeBins(n.options.bins,[n.xMin,n.xMax])}function N(){if(n.options.statLabels){var e,t,i;e=n.options.population.length,t=1,n.options.withReplacement||(t=Math.sqrt((e-n.options.sampleSize+0)/(e-1))),n.options.statisticType==r?(i=n.options.sampleSize*n.popMean,statExpText="E(sum): "+Number(i).toFixed(2),se=t*n.popSd*Math.sqrt(n.options.sampleSize),statSEText="SE(sum): "+Number(se).toFixed(2),statSampleMeanText="Mean(values) = "+Number(mean(n.sampleMean)).toFixed(4),statSampleSDText="SD(values) = "+Number(sd(n.sampleMean)).toFixed(4)):n.options.statisticType==s?(i=n.popMean,statExpText="E(mean): "+Number(i).toFixed(2),se=t*n.popSd*Math.sqrt(n.options.sampleSize),statSEText="SE(mean): "+Number(se).toFixed(2),statSampleMeanText="Mean(values) = "+Number(mean(n.sampleMean)).toFixed(4),statSampleSDText="SD(values) = "+Number(sd(n.sampleMean)).toFixed(4)):n.options.statisticType==o?(i=n.popMean,statExpText="E(t): "+Number(i).toFixed(2),n.options.sampleSize>2?se=Math.sqrt((n.options.sampleSize+0)/(n.options.sampleSize-2)):se=NaN,statSEText="SE(t): "+Number(se).toFixed(2),statSampleMeanText="Mean(values) = "+Number(mean(n.sampleT)).toFixed(4),statSampleSDText="SD(values) = "+Number(sd(n.sampleT)).toFixed(4)):n.options.statisticType==a?(n.options.withReplacement?i=n.popSd*n.popSd:i=n.popSd*n.popSd*e/e-1,se=Math.sqrt(2/(n.options.sampleSize-1))*n.popSd*n.popSd,statExpText="E(S-squared): "+Number(i).toFixed(2),statSEText="df: "+(n.options.sampleSize-1),statSampleMeanText="Mean(values) = "+Number(mean(n.sampleSsq)).toFixed(4),statSampleSDText="SD(values) = "+Number(sd(n.sampleSsq)).toFixed(4)):n.options.statisticType==u&&(i=e,statExpText="df: "+Number(i).toFixed(2),se=Math.sqrt(2*(e-1)),statSEText="     ",statSampleMeanText="Mean(values) = "+Number(mean(n.sampleSsq)).toFixed(4),statSampleSDText="SD(values) = "+Number(sd(n.sampleSsq)).toFixed(4)),n.samplesSoFar===0&&(statSampleMeanText="Mean(values) = NaN",statSampleSDText="SD(values) = NaN"),n.options.statisticType==u?(popMeanText="Categories: "+n.options.population.length,popSdText="E(Chi-Squared): "+(n.options.population.length-1)):(popMeanText="Ave(Box): "+Number(n.popMean).toFixed(2),popSdText="Sd(Box): "+Number(n.popSd).toFixed(2)),samplesSoFarText="Samples: "+n.samplesSoFar;var f=[popMeanText,popSdText,statExpText,statSEText,statSampleMeanText,statSampleSDText,samplesSoFarText];n.statsBox.children().remove();var l=jQuery("<ul/>");f.map(function(e){l.append(jQuery("<li/>").text(e))}),n.statsBox.append(l)}}function C(){n.samplesSoFar=0,n.sampleMean=[],n.sampleSum=[],n.sampleSsq=[],n.sampleT=[],N(),D()}function L(){for(var e=0;e<n.options.samplesToTake;e++){var t=[],r=[],i,s=0,o=0,a=0;if(n.options.statisticType==u)if(n.options.populationType!=f)console.log("can't do that");else{var h=[],p=[];for(i=0;i<n.options.population.length;i++)h[i]=n.options.population[i],p[i]=0;h[0]=n.options.population[0];for(i=1;i<n.options.population.length;i++)h[i]+=h[i-1];for(i=0;i<n.options.sampleSize;i++){tmp=Math.random(),tmp<=h[0]&&p[0]++;for(k=0;k<p.length;k++)tmp>h[k-1]&&tmp<=h[k]&&p[k]++}o=0;for(i=0;i<n.options.population.length;i++)tmp=n.options.sampleSize*n.options.population[i],o+=(p[i]-tmp)*(p[i]-tmp)/tmp;n.sampleSsq[n.samplesSoFar++]=o}else{if(n.options.populationType==f){n.options.withReplacement?r=listOfRandInts(n.options.sampleSize,0,n.options.population.length-1):r=listOfDistinctRandInts(n.options.sampleSize,0,n.options.population.length-1);for(i=0;i<n.options.sampleSize;i++)t[i]=n.options.population[r[i]],s+=t[i]}else if(n.options.populationType==l)for(i=0;i<n.options.sampleSize;i++)t[i]=Math.random(),s+=t[i];else if(n.options.populationType==c)for(i=0;i<n.options.sampleSize;i++)t[i]=rNorm(),s+=t[i];s/=n.options.sampleSize;for(i=0;i<n.options.sampleSize;i++)o+=(t[i]-s)*(t[i]-s);n.options.sampleSize>1?(o/=n.options.sampleSize-1,n.sampleSsq[n.samplesSoFar]=o,a=s/(Math.sqrt(o)/Math.sqrt(n.options.sampleSize)),n.sampleT[n.samplesSoFar]=a):(n.sampleSsq[n.samplesSoFar]=0,n.sampleT[n.samplesSoFar]=0),n.sampleMean[n.samplesSoFar]=s,n.sampleSum[n.samplesSoFar]=s*n.options.sampleSize,n.samplesSoFar++}}}function D(){function m(e){var t=histMakeCounts(n.binEnds,n.options.population);if(n.options.population.length!==0){var r=d3.select(e.get(0)).append("svg").selectAll("div");r.data(t).enter().append("rect").attr("y",function(e){return p-e/v}).attr("height",function(e){return e/v}).attr("x",function(e,t){return h*(n.binEnds[t]-n.binEnds.min())/d}).attr("width",function(e,t){return h*(n.binEnds[t+1]-n.binEnds[t])/d}).attr("class","population")}}function g(e){if(f.length!==0){n.sampleBinCounts=histMakeCounts(n.binEnds,f);var t=d3.select(e.get(0)).append("svg").selectAll("div");t.data(n.sampleBinCounts).enter().append("rect").attr("y",function(e){return p-e/v}).attr("height",function(e){return e/v}).attr("x",function(e,t){return h*(n.binEnds[t]-n.binEnds.min())/d}).attr("width",function(e,t){return h*(n.binEnds[t+1]-n.binEnds[t])/d}).attr("class","sample")}}function E(){var e=d3.svg.line().x(function(e){return e}).y(function(e){return p-A(e)/v}),t=d3.select(n.curveOverlayDiv.get(0)).append("svg").attr("height","100%"),r=t.append("path");r.attr("class","nrestricted"),r.data([d3.range(0,h)]).attr("d",e)}T();var e=jQuery("<div/>").addClass("chart_box");n.chartDiv.children().remove(),n.overlayDiv=e.clone().addClass("overlay");var t=e.clone().addClass("sample_chart");n.curveOverlayDiv=jQuery("<div/>").addClass("chart_box"),n.chartDiv.append(e),n.chartDiv.append(t),n.chartDiv.append(n.overlayDiv),n.chartDiv.append(n.curveOverlayDiv);var f;n.options.statisticType==s?f=n.sampleMean:n.options.statisticType==r?f=n.sampleSum:n.options.statisticType==a||n.options.statisticType==u?f=n.sampleSsq:n.options.statisticType==o&&(f=n.sampleT);var l=n.options.population.concat(f),c=histMakeCounts(n.binEnds,l),h=n.overlayDiv.width(),p=n.overlayDiv.height(),d=n.binEnds.max()-n.binEnds.min(),v=null;n.curveYFunction=A;for(i=0;i<h;i++)(v===null||n.curveYFunction(i)>v)&&!isNaN(A(i))&&(v=A(i));v=Math.max(c.max(),v),v/=p-1,g(n.overlayDiv),g(t),n.overlayDiv.css("clip","rect(0px, 0px, "+p+"px, 0px)"),m(e);var y=d3.select(e.get(0)).append("svg").attr("class","axis"),b=d3.scale.linear().domain([n.binEnds.min(),n.binEnds.max()]).range([0,h]),w=d3.svg.axis().scale(b).orient("bottom");y.append("g").call(w),E(),n.options.showCurve||n.curveOverlayDiv.hide()}function P(){var e=parseFloat(n.areaFromSlider.slider("value")),t=parseFloat(n.areaToSlider.slider("value")),r=n.chartDiv.width()/(n.binEnds.max()-n.binEnds.min()),i=(e-n.binEnds.min())*r,s=(t-n.binEnds.min())*r;n.overlayDiv.css("clip","rect(0px,"+s+"px,"+n.chartDiv.height()+"px,"+i+"px)");var o=0;n.sampleBinCounts!==null&&(o=histHiLitArea(e,t,n.binEnds,n.sampleBinCounts)),o*=100;var u="Selected area: "+o.fix(2)+"%";n.areaInfoSpan.text(u)}function H(){function x(e){r.append(e),b+=i}function T(){var e=jQuery('<input type="text" id="sampleSize" />').val(n.options.sampleSize).change(function(e){e.preventDefault(),n.options.sampleSize=jQuery(this).val(),C(),D()});return e}function k(){var e=jQuery('<input type="text" id="samplesToTake" />').val(n.options.samplesToTake).change(function(e){e.preventDefault(),n.options.samplesToTake=jQuery(this).val(),C(),D()});return e}function H(){var e=jQuery('<input type="text" id="bins" />').val(n.options.bins).change(function(e){e.preventDefault(),n.options.bins=parseInt(jQuery(this).val(),10),n.options.populationType==c?n.options.population=E():n.options.populationType==l&&(n.options.population=w()),C()});return e}function B(){var e=jQuery("<div/>");n.options.toggleVar?(n.statisticSelect=jQuery("<select/>").change(function(e){prevStatisticType=n.options.statisticType,e.preventDefault(),jQuery(this).val()!=u||n.options.populationType!=l&&n.options.populationType!=c?n.options.statisticType=jQuery(this).val():(n.options.statisticType=s,jQuery(this).val(s)),n.options.statisticType==u?(n.stashedBoxPopulation=n.options.population,pop=n.options.population,pop=pop.filter(function(e){if(e!==0&&!isNaN(e))return e}),pop=vMult(1/vSum(pop),pop),pop=pop.map(function(e){return parseFloat(Number(e).toFixed(5))}),n.options.population=pop):n.options.populationType==f&&prevStatisticType==u&&(n.options.population=n.stashedBoxPopulation),y(),U(jQuery("div#popText")),m(),n.reloadChart()}),jQuery.each(n.options.statisticTypes,function(e,t){n.statisticSelect.append(jQuery("<option/>").attr("value",t[1]).text(t[0]))}),n.statisticSelect.val(n.options.statisticType)):n.statisticSelect="Sample Mean&nbsp;&nbsp;",e.append("Distribution of: ").append(n.statisticSelect),n.dataSelect=jQuery("<select/>").change(function(e){e.preventDefault(e),n.options.populationType==f&&(n.stashedBoxPopulation=n.options.population),jQuery(this).val()==c?(n.options.populationType=c,n.options.boxContents="Normal",n.options.statisticType==u&&(n.options.statisticType=s,n.statisticSelect.val(s))):jQuery(this).val()==f?(n.options.populationType=f,n.options.boxContents=n.stashedBoxPopulation.join("\n")):jQuery(this).val()==l&&(n.options.populationType=l,n.options.boxContents="Uniform",n.options.statisticType==u&&(n.options.statisticType=s,n.statisticSelect.val(s))),U(jQuery("div#popText")),m(),C(),n.reloadChart()}),jQuery.each(n.sourceChoices,function(e,t){n.dataSelect.append(jQuery("<option/>").attr("value",t).text(t))}),jQuery.inArray(f,n.sourceChoices)!=-1?defaultVal=f:defaultVal=n.sourceChoices[0],n.dataSelect.val(defaultVal),e.append("Sample from: ").append(n.dataSelect),n.options.replaceControl&&(n.replacementCheckbox=jQuery('<input type="checkbox" id="withReplacement" />').change(function(e){e.preventDefault(),n.options.withReplacement=!n.options.withReplacement,m(),C(),n.reloadChart()}),n.options.withReplacement&&n.replacementCheckbox.attr("checked",!0),e.append(n.replacementCheckbox).append(" with replacement")),n.takeSampleButton=jQuery('<button id="takeSample"/>').addClass("open").text("Take Sample").click(function(e){e.preventDefault(),L(),n.reloadChart()}),e.append(n.takeSampleButton),jQuery("#top_controls").append(e)}function j(){n.populationTextArea=jQuery('<textarea id="population">'+n.options.boxContents+"</textarea>").addClass("populationControls"),n.options.boxEditable||n.populationTextArea.attr("readonly","readonly"),n.populationTextArea.change(function(e){e.preventDefault(),n.options.populationType==f&&(n.options.population=S(),m(),n.reloadChart())})}function F(){n.showPopulationButton=jQuery("<button/>").addClass("open"),n.options.showPopulation?n.showPopulationButton.text("Hide Population Histogram"):n.showPopulationButton.text("Show Population Histogram"),n.showPopulationButton.click(function(e){e.preventDefault(),jQuery(".population").toggle(),n.options.showPopulation?n.showPopulationButton.text(n.showPopulationButton.text().replace("Hide","Show")):n.showPopulationButton.text(n.showPopulationButton.text().replace("Show","Hide")),n.options.showPopulation=!n.options.showPopulation,P()}),n.areaInfoDiv.css("bottom",b+"px"),r.css("height",b+"px"),n.chartDiv.css("margin-bottom",b+15+"px"),n.chartDiv.css("margin-top",g+"px")}function I(){var e=jQuery("<div/>");n.areaFromInput=jQuery('<input type="text" />').change(function(){n.areaFromSlider.slider("value",n.areaFromInput.val())});var t=function(){n.areaFromInput.val(n.areaFromSlider.slider("value")),P()};n.areaFromSlider=jQuery("<span/>").addClass("slider").slider({change:t,slide:t,step:.001}),e.append("Area from: ").append(n.areaFromInput).append(n.areaFromSlider),n.areaToInput=jQuery('<input type="text" />').change(function(){n.areaToSlider.slider("value",n.areaToInput.val())});var r=function(){n.areaToInput.val(n.areaToSlider.slider("value")),P()};n.areaToSlider=jQuery("<span/>").addClass("slider").slider({change:r,slide:r,step:.001}),e.append(" to: ").append(n.areaToInput).append(n.areaToSlider),x(e)}function q(){var e=jQuery("<select/>").change(function(e){e.preventDefault(),jQuery(this).val()==h?(n.options.showCurve=!1,n.curveOverlayDiv.hide()):(n.options.showCurve=!0,jQuery(this).val()==p?(m(),n.curveYFunction=A,isNaN(n.mu)||isNaN(n.sd)?(n.options.showCurve=!1,jQuery(this).val(h)):n.reloadChart()):jQuery(this).val()==v?n.options.statisticType==a?(m(),n.curveYFunction=M,n.reloadChart()):n.options.statisticType==u?(m(),n.curveYFunction=O,n.reloadChart()):(n.options.showCurve=!1,jQuery(this).val(h)):jQuery(this).val()==d&&(n.options.statisticType==o?(m(),n.curveYFunction=_,n.reloadChart()):(n.options.showCurve=!1,jQuery(this).val(h))))});return jQuery.each(n.options.curveTypes,function(t,n){e.append(jQuery("<option/>").attr("value",n[1]).text(n[0]))}),e}function U(e){j(),e.html(""),e.append(n.populationTextArea),e.append(n.popTextLabel)}var e=jQuery("div#statsText");n.statsBox=e,N();var t=jQuery("<div/>").addClass("stici").addClass("stici_sampledist");n.container.append(t),n.chartDiv=jQuery("<div/>").addClass("stici_chart").addClass("chart_box"),t.append(n.chartDiv),n.areaInfoDiv=jQuery("<div/>").addClass("area_info"),t.append(n.areaInfoDiv);var r=jQuery("<div/>").addClass("bottom_controls");t.append(r);var i=30,g=0,b=0,R=jQuery("<div/>");B(),F(),n.areaInfoSpan=jQuery("<span/>"),n.options.showPopulationButton&&(R.append(n.areaInfoSpan),R.append(q()),R.append(n.showPopulationButton)),U(jQuery("div#popText"));var z=jQuery("<div/>");z.append("Sample Size: "),z.append(T()),z.append(" Take "),z.append(k()),z.append("samples. "),n.options.binControls&&(z.append(" Bins: "),z.append(H())),R.children().length>0&&(x(R),I(),x(z)),n.areaInfoDiv.css("bottom",b+"px"),r.css("height",b+"px"),n.chartDiv.css("margin-bottom",b+15+"px"),n.chartDiv.css("margin-top",g+"px")}var n=this,r="sum",s="mean",o="t",u="chisquared",a="ssq",f="Box",l="Uniform",c="Normal",h="none",p="normal",d="t",v="chisquared";if(!t instanceof Object){console.error("Stici_SampleDist params should be an object");return}this.options={bins:10,population:[0,1,2,3,4],boxContents:[0,1,2,3,4].join("\n"),showPopulationButton:!0,showPopulation:!0,populationType:f,dataSets:[l,f,c],sources:"all",variables:"all",startsWith:null,statisticTypes:[["Sample Chi-Squared",u],["Sample Mean",s],["Sample t",o],["Sample Sum",r],["Sample S-Squared",a]],statisticType:r,withReplacement:!0,sampleSize:5,samplesToTake:1,boxEditable:!0,toggleVar:!0,replaceControl:!0,statLabels:!0,binControls:!0,curveTypes:[["No Curve",h],["Normal Curve",p],["Student t Curve",d],["Chi-Squared Curve",v]],hiLiteLo:null,hiLiteHi:null,showCurve:!1},this.xMin=0,this.xMax=10,this.popMin=null,this.popMax=null,this.popMean=null,this.popSd=null,this.samplesSoFar=0,this.sampleMean=[],this.sampleSum=[],this.sampleSsq=[],this.sampleT=[],this.binEnds=[],this.sampleBinCounts=null,this.mu=0,this.sd=0,this.curveYFunction=function(e){return e},this.overlayDiv=jQuery("<div/>"),this.replacementCheckbox=null,this.statisticSelect=null,this.dataSelect=null,this.popTextLabel="Population",this.stashedBoxPopulation=[0,1,2,3,4],this.sourceList=[l,f,c],this.sourceChoices=null,this.areaFromInput=null,this.areaFromSlider=null,this.areaToInput=null,this.areaToSlider=null,this.areaInfoSpan=null,jQuery.extend(this.options,t),this.container=jQuery("#"+e),this.reloadChart=function(){n.areaFromSlider.slider("option","min",n.binEnds.min()),n.areaFromSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteLo===null?(n.areaFromSlider.slider("option","value",n.binEnds.min()),n.areaFromInput.val(n.binEnds.min())):(n.areaFromSlider.slider("option","value",n.options.hiLiteLo),n.areaFromInput.val(n.options.hiLiteLo)),n.areaToSlider.slider("option","min",n.binEnds.min()),n.areaToSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteHi===null?(n.areaToSlider.slider("option","value",n.binEnds.min()),n.areaToInput.val(n.binEnds.min())):(n.areaToSlider.slider("option","value",n.options.hiLiteHi),n.areaToInput.val(n.options.hiLiteHi)),b(),N(),D(),P()};var A=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.options.bins]-n.binEnds[0])/(n.overlayDiv.width()-1),r=normPdf(n.mu,n.sd,t);return r},O=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.options.bins]-n.binEnds[0])/(n.overlayDiv.width()-1),r=0;return r},M=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.options.bins]-n.binEnds[0])/(n.overlayDiv.width()-1),r=0;return r},_=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.options.bins]-n.binEnds[0])/(n.overlayDiv.width()-1),r=0;return r},B=n.options.sources.split("\n	");B.length>0?jQuery.inArray("all",B)!=-1?n.sourceChoices=n.sourceList:n.sourceChoices=B.filter(function(e){if(jQuery.inArray(e,n.sourceList)!=-1)return e}):n.sourceChoices=n.sourceList,H(),m(),this.reloadChart(),n.options.showPopulation||jQuery(".population").toggle()}function Stici_Scatterplot(e,t){function r(){var e=n.container.find(".bottom_controls"),t=n.container.find(".popbox-controls");n.options.files=[],n.dataFields=[],n.dataValues=[],n.dataSource=n.dataSelect.val();var r=3,i=2;jQuery.getJSON(n.dataSource,function(e){n.dataFields=e[0],n.dataValues=e.slice(1),n.xVariableSelect.empty(),n.yVariableSelect.empty(),$.each(n.dataFields,function(e,t){if(t.indexOf("//")>-1)return!0;!n.inited&&null!==n.options.Xinit&&t==n.options.Xinit&&(r=e),!n.inited&&null!==n.options.Yinit&&t==n.options.Yinit&&(i=e),n.xVariableSelect.append($("<option/>").attr("value",e).text(t)),n.yVariableSelect.append($("<option/>").attr("value",e).text(t))}),n.xVariableSelect.val(r),n.yVariableSelect.val(i),n.container.find(".popbox-controls").empty(),n.createPopbox("list-data"),n.createPopbox("univar-stats"),n.container.find(".popbox").popbox({toggler:["list-data","univar-stats"]}),n.container.find(".popbox-content table").css("width",n.dataFields.length*120+"px"),n.container.find(".popbox").on("mouseover mouseout click",function(e){e.preventDefault(),a(e)}),n.prepareData(),n.reloadChart()})}function i(){var e=cNormPoints(n.n,n.r),t=e[0],r=e[1];n.n==1&&(t=[5.5],r=[5.5]),n.currentData=$.map(t,function(e,n){return{x:t[n],y:r[n],index:n,added:!1,selected:!1}}),n.reloadChart()}function s(){n.currentData=$.map(n.options.x,function(e,t){return{x:n.options.x[t],y:n.options.y[t],index:t,added:!1,selected:!1}}),n.reloadChart()}function o(){var e=$("<div/>").addClass("stici").addClass("stici_scatterplot"),t=$("<div/>").addClass("top_controls");n.container.append(e),e.append(t),typeof n.options.title=="string"&&t.append(n.options.title),n.chartDiv=$("<div/>").addClass("stici_chart").addClass("chart_box"),e.append(n.chartDiv);if(l())n.urlInput=$('<input type="text" />'),n.dataSelect=$('<select class="data_select"/>').change(n.reloadData),n.xVariableSelect=$('<select class="variable_select"/>').change(function(){n.prepareData(),n.reloadChart()}),n.yVariableSelect=$('<select class="variable_select"/>').change(function(){n.prepareData(),n.reloadChart()}),t.append("Data: "),n.options.files.length>1?t.append(n.dataSelect):(t.append(n.options.files[0].replace(/^.*[\\\/]/,"")),t.append("&nbsp;&nbsp;&nbsp;")),$.each(n.options.files,function(e,t){n.dataSelect.append($("<option/>").attr("value",t).text(t.replace(/^.*[\\\/]/,"")))}),t.append(n.yVariableSelect),t.append(" vs "),t.append(n.xVariableSelect);else if(c()){n.rInput=jQuery('<input type="text" />').change(function(){if(!n.inited)return;s.slider("value",n.rInput.val()),n.r=n.rInput.val(),i()});var r=function(){if(!n.inited)return;n.rInput.val(s.slider("value")),n.r=s.slider("value"),i()},s=jQuery("<span/>").addClass("slider").slider({change:r,slide:r,step:.001,max:1,min:-1});n.rInput.val(n.r),s.slider("value",n.rInput.val()),n.options.showRBar&&t.append("r: ").append(n.rInput).append(s);var o=jQuery('<input type="text" />').change(function(){if(!n.inited)return;f.slider("value",o.val()),n.n=o.val(),i()}),a=function(){if(!n.inited)return;o.val(f.slider("value")),n.n=f.slider("value"),i()},f=jQuery("<span/>").addClass("slider").slider({change:a,slide:a,step:1,max:200,min:3});n.options.showRBar&&(o.val(n.n),f.slider("value",o.val()),t.append("n: ").append(o).append(f))}var h=$("<div/>").addClass("bottom_controls").addClass("extended"),p=$("<span/>").data("btnId","r-hat").text("r: 0.16"),d=$("<button/>").data("btnId","sds").text("SDs"),v=$("<button/>").data("btnId","sd-line").text("SD Line"),m=$("<button/>").data("btnId","graph-of-ave").text("Graph of Ave"),g=$("<button/>").data("btnId","reg-line").text("Regression Line"),y=$("<button/>").data("btnId","res-plot").text("Plot Residuals"),b=$("<div/>").attr("class","popbox-controls"),w=$("<button/>").data("btnId","use-points").text("Use Added Points"),E=$("<button/>").data("btnId","clear-points").text("Clear Added Points"),S=$("<span/>").addClass("cursor-pos").text("");e.append(h),n.options.showR&&!c()&&h.append(p),n.options.sdButton&&h.append(d),n.options.sdLineButton&&h.append(v),n.options.graphAveButton&&h.append(m),n.options.regressButton&&h.append(g),n.options.residualsButton&&h.append(y),h.append("<br/>").append(b),n.options.addPoints&&h.append(w).append(E),h.append(S),e.find("button").on("click",function(e){e.preventDefault(),u(e)})}function u(e){var t=n.container.find(e.target),r=t.data("btnId");r!=="clear-points"&&r!=="list-data"&&r!=="univar-stats"&&(t.toggleClass("selected"),n.bottomControls[r]=n.bottomControls[r]===!0?!1:!0),n.toggleOption(r,t.hasClass("selected"))}function a(e){var t=e.type,r=n.container.find(e.target),i=r.closest("table"),s,o;i.hasClass("data-values")&&(s=r.closest("tr"),o=s.attr("data-index"),n.highlightDataPoint(o,t))}function f(e){n.container.find(".bottom_controls").children().filter(function(){return $(this).data("btnId")==e}).click()}function l(){return n.options.files!==null?!0:!1}function c(){return n.options.r!==null||n.options.n!==null?!0:!1}function h(){return n.options.x!==null||n.options.y!==null?!0:!1}var n=this;if(!t instanceof Object){console.error("Stici_ScatterPlot params should be an object");return}this.options={title:null,graphAveButton:!0,graphOfAvePoints:9,addPoints:!0,regressButton:!0,residualsButton:!0,sdButton:!0,sdLineButton:!0,showR:!0,showRBar:!0,showSDs:!1,showSdLine:!1,showGraphOfAve:!1,showRegress:!1,showResiduals:!1,files:null,Xinit:null,Yinit:null,r:null,n:null,x:null,y:null},jQuery.each(t,function(e){typeof n.options[e]=="undefined"&&console.warn("Stici_Scatterplot: Unknown key '"+e+"'")}),jQuery.extend(this.options,t);if(!this.options.showRBar||!this.options.showR)this.options.showRBar=!1,this.options.showR=!1;this.container=$("#"+e);if(!c()&&!l()&&!h()){console.error("Unknown scatterplot data source."),n.container.html("Unable to load scatterplot: unknown data source.");return}this.dataFields=null,this.dataValues=null,this.dataSource=null,this.inited=!1,this.urlInput=null,this.dataSelect=null,this.xVariableSelect=null,this.yVariableSelect=null,this.currentData=null,this.xScale=null,this.yScale=null,this.chartWidth=this.container.width()-20,this.chartHeight=this.container.height()-100,this.chartDiv=null,this.r=null,this.n=null,this.rInput=null,this.chartMargins={top:"10",right:"10",bottom:"25",left:"40"},this.bottomControls={sds:!1,"sd-line":!1,"avg-graph":!1,"reg-line":!1,"res-plot":!1,"use-points":!1,"plot-mean":!0,"r-hat":!0},this.reloadData=null;if(l())!t.files instanceof Array?(this.dataSource=null,this.options.files=[]):this.dataSource=this.options.files[0],this.reloadData=r;else if(c())this.n=n.options.n,this.r=n.options.r,this.reloadData=i;else if(h()){if(n.options.x.length!=n.options.y.length){console.error("Data has been manually specified, but x and y options have different numbers of data points."),n.container.html("Invalid data supplied.");return}this.reloadData=s}this.prepareData=function(){n.currentData=$.map(n.dataValues,function(e,t){return{x:parseFloat(e[n.xVariableSelect.val()]),y:parseFloat(e[n.yVariableSelect.val()]),index:t,added:!1,selected:n.container.find('.popbox.list-data tr[data-index="'+t+'"]').hasClass("selected")}})},this.setScale=function(e){var t=n.chartWidth,r=n.chartMargins,i=d3.min(e,function(e){return e.x}),s=d3.max(e,function(e){return e.x}),o,u=d3.min(e,function(e){return e.y}),a=d3.max(e,function(e){return e.y}),f;i==s&&(i-=4.5,s+=4.5),u==a&&(u-=4.5,a+=4.5),o=d3.scale.linear().domain([i,s]).range([0,t-r.left-r.right]).nice(),a<.001&&u>-0.001&&(a=1,u=-1),f=d3.scale.linear().domain([u,a]).range([n.chartHeight-n.chartMargins.top-n.chartMargins.bottom,0]).nice(),n.xScale=o,n.yScale=f},this.initCanvas=function(){n.chartDiv.empty();var e=n.chartWidth,t=n.chartHeight,r=d3.select(n.chartDiv.get(0)).append("svg").attr("width",n.chartWidth).attr("height",n.chartHeight)},this.drawDataPlot=function(){var e=n.currentData;n.initCanvas(),n.setScale(e),n.plotAxes("data"),n.plotPoints(e,"data"),n.drawMouseRect(),n.updateRHat()},this.plotAxes=function(e){var t=n.xScale,r=n.yScale,i=n.chartMargins,s=n.chartWidth,o=n.chartHeight,u=d3.svg.axis().scale(t).orient("bottom"),a=d3.svg.axis().scale(r).orient("left"),f=d3.select(n.chartDiv.get(0)).select("svg");e==="data"?f.append("g").attr("class","x axis").attr("transform","translate("+i.left+", "+(o-i.bottom)+")").call(u):f.append("g").attr("class","x axis").attr("transform","translate("+i.left+", "+(r(0)+1*i.top)+")").call(u),f.append("g").attr("class","y axis").attr("transform","translate("+i.left+", "+i.top+")").call(a),f.select("g.x.axis").append("line").attr("class","line x-axis").attr("x1",0).attr("x2",s-i.left).attr("y1",0).attr("y2",0),f.select("g.y.axis").append("line").attr("class","line y-axis").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",o-i.bottom-i.top)},this.reloadChart=function(){n.bottomControls["res-plot"]===!0?n.toggleResPlot(!0):(n.drawDataPlot(),n.plotSelectedOptions(["res-plot"])),n.inited||(n.options.showSdLine&&f("sd-line"),n.options.showSDs&&f("sds"),n.options.showGraphOfAve&&f("graph-of-ave"),n.options.showRegress&&f("reg-line"),n.options.showResiduals&&f("res-plot")),n.inited=!0},this.updateRHat=function(){var e=n.filterData(),t=$.map(e,function(e){return e.x}),r=$.map(e,function(e){return e.y}),i=corr(t,r).toFixed(2);c()&&n.rInput.val(i),n.container.find(".bottom_controls").children().filter(function(){return $(this).data("btnId")=="r-hat"}).text("r: "+i)},this.plotSelectedOptions=function(e){var t;e=e||[];for(var r in n.bottomControls){if(e.indexOf(r)>-1)continue;t=n.bottomControls[r],n.toggleOption(r,t)}},this.toggleOption=function(e,t){switch(e){case"sds":n.toggleSds(t);break;case"sd-line":n.toggleSdLine(t);break;case"graph-of-ave":n.toggleGraphOfAve(t);break;case"reg-line":n.toggleRegLine(t);break;case"res-plot":n.toggleResPlot(t);break;case"use-points":n.toggleUsePoints();break;case"clear-points":n.toggleClearPoints();break;case"plot-mean":n.plotMean();break;case"r-hat":n.updateRHat();break;default:}},this.createPopbox=function(e){var t,r,i,s;e==="list-data"?(r="List Data",t=n.createListDataHtml(),i="list-data"):e==="univar-stats"&&(r="Univariate Stats",t=n.createUnivarStatsHtml(),i="univar-stats"),s='<div class="popbox '+e+'">'+'<button class="open" id="'+i+'">'+r+"</button>"+'<div class="collapse">'+'<div class="box">'+'<div class="arrow"></div>'+'<div class="arrow-border"></div>'+'<div class="popbox-content">'+t+"</div>"+"</div>"+"</div>"+"</div>",n.container.find(".bottom_controls .popbox-controls").append(s)},this.createUnivarStatsHtml=function(){var e='<div class="univariate-stats-container">';return $.each(n.dataFields,function(t){if(n.dataFields[t].indexOf("//")===0)return;e+='<div class="univariate-stat-wrapper"><h3>'+n.dataFields[t]+"</h3>";var r=$.map(n.dataValues,function(e){return parseFloat(e[t])});e+='<ul class="stat-list"><li class="stat-item">Cases: '+r.length+"</li>"+'<li class="stat-item">Mean: '+mean(r).toFixed(2)+"</li>"+'<li class="stat-item">SD: '+sd(r).toFixed(2)+"</li>"+'<li class="stat-item">Min: '+r.min().toFixed(2)+"</li>"+'<li class="stat-item">LQ: '+percentile(r,25).toFixed(2)+"</li>"+'<li class="stat-item">Median: '+percentile(r,50).toFixed(2)+"</li>"+'<li class="stat-item">UQ: '+percentile(r,75).toFixed(2)+"</li>"+'<li class="stat-item">Max: '+r.max().toFixed(2)+"</li>"+"</ul>",e+="</div>"}),e+="</div>",e},this.createListDataHtml=function(){var e=n.dataFields,t=n.dataValues,r=e.length,i,s,o,u;u='<div class="table-container"><div class="table-header"><table class="data-fields"><thead><tr>';for(var a=0;a<e.length;a++)u+="<td>"+e[a]+"</td>";u+="</tr></thead></table></div>",u+='<div class="table-body"><table class="data-values"><tbody>';for(var f=0;f<t.length;f++){i=t[f],i.length>e.length&&(o=i.slice(e.length-1).join(" ").replace(/[\/]/g,""),i=i.slice(0,e.length-1),i.push(o)),u+='<tr data-index="'+f+'">';for(var l=0;l<i.length;l++)s=i[l],u+="<td>"+s+"</td>";u+="</tr>"}return u+="</tbody></table></div></div>",u},this.toggleClearPoints=function(){n.currentData=$.grep(n.currentData,function(e,t){return e.added===!1}),d3.select(n.chartDiv.get(0)).selectAll('.data-point[data-added="true"]').remove(),n.plotSelectedOptions(["res-plot","use-points"])},this.toggleUsePoints=function(){n.plotSelectedOptions(["res-plot","use-points"]),n.bottomControls["res-plot"]&&n.toggleResPlot(!0)},this.toggleResPlot=function(e){var t=n.filterData(),r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),s=mean(r),o=mean(i),u=sd(r),a=sd(i),f=corr(r,i),l=f*a/u,c,h,p,d,v=n.currentData.length;if(e){n.initCanvas(),n.residualData=[];for(var m=0;m<v;m++)h=n.currentData[m],c=o-l*(s-h.x),p=h.y-c,n.residualData.push({x:h.x,y:p,added:h.added,index:h.index});n.setScale(n.residualData),n.plotAxes("residual"),n.plotPoints(n.residualData,"residual"),n.drawMouseRect(),n.plotSelectedOptions(["res-plot","use-points"])}else n.drawDataPlot(),n.plotSelectedOptions(["res-plot"])},this.plotPoints=function(e,t){var r=n.chartMargins,i=n.xScale,s=n.yScale,o=t==="data"?"plot-data":"plot-residual",u=d3.select(n.chartDiv.get(0)).select("svg").append("g").attr("class",o+" plot").attr("transform","translate("+r.left+","+r.top+")"),a;u.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t="data-point",n=e.selected?"selected":"",r=e.added?"added":"";return t+" "+n+" "+r}).attr("cx",function(e){return i(e.x)}).attr("cy",function(e){return s(e.y)}).attr("stroke","#333").attr("stroke-width","1").attr("data-index",function(e){return e.index}).attr("data-added",function(e){return e.added}).attr("data-x",function(e){return e.x}).attr("data-y",function(e){return e.y}).attr("r",function(e){return e.selected?3.5:2}).attr("fill",function(e){return"rgba(0, 0, 255, 1)"}),d3.select(n.chartDiv.get(0)).selectAll(".data-point").sort(function(e){return e&&e.selected===!0?1:-1})},this.drawMouseRect=function(){var e=n.chartMargins,t=n.chartWidth,r=n.chartHeight,i=n.xScale,s=n.yScale,o=d3.select(n.chartDiv.get(0)).select(".plot");o.append("rect").attr("class","mouse-event-handler").attr("width",t-e.left-e.right).attr("height",r-e.top-e.bottom).attr("fill","rgba(0, 0, 0, 0)").on("mousemove",function(){var e=d3.mouse(this),t=e[0],r=e[1],o=i.invert(t).toFixed(2),u=s.invert(r).toFixed(2);n.container.find(".cursor-pos").text(" x = "+o+"  y = "+u)}),d3.select(n.chartDiv.get(0)).select(".plot-data.plot .mouse-event-handler").on("click",function(){if(!n.options.addPoints)return;var e=d3.mouse(this),t=e[0],r=e[1],o=i.invert(t).toFixed(2),u=s.invert(r).toFixed(2),a={x:parseFloat(o),y:parseFloat(u),added:!0,index:n.currentData.length};n.currentData.push(a),n.plotPoint(a),!n.bottomControls["res-plot"]&&n.bottomControls["use-points"]&&n.plotSelectedOptions(["res-plot","use-points"])})},this.plotPoint=function(e){var t=n.yScale,r=n.xScale;pointPlot=d3.select(n.chartDiv.get(0)).select(".plot-data.plot"),pointPlot.insert("circle",".data-point").attr("class","data-point added").attr("cx",r(e.x)).attr("cy",t(e.y)).attr("stroke","#333").attr("stroke-width","1").attr("data-index",e.index).attr("data-added",e.added).attr("data-x",e.x).attr("data-y",e.y).attr("r",2)},this.toggleRegLine=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c,h,p,d,v,m;n.container.find("svg g.reg-line").remove(),e&&(r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),u=d3.min(r),a=d3.max(r),s=mean(r),o=mean(i),f=sd(r),l=sd(i),h=corr(r,i),c=h*l/f,d={x:s,y:o},v={x:u,y:d.y-c*(d.x-u)},m={x:a,y:d.y-c*(d.x-a)},p=d3.select(n.chartDiv.get(0)).select(".plot-data").append("g").attr("class","reg-line"),p.append("line").attr("x1",n.xScale(v.x)).attr("x2",n.xScale(m.x)).attr("y1",n.yScale(v.y)).attr("y2",n.yScale(m.y)))},this.toggleGraphOfAve=function(e){var t=n.bottomControls["res-plot"]===!0?"plot-residual":"plot-data",r=n.filterData(),i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;n.container.find("svg g.graph-of-ave").remove();if(e){i=$.map(r,function(e){return e.x}),s=$.map(r,function(e){return e.y}),o=d3.max(i),u=d3.min(i),w=(o-u)/n.options.graphOfAvePoints,a=mean(i),f=mean(s),l=sd(i),c=sd(s),h=corr(i,s),p=h*c/l,x=d3.select(n.chartDiv.get(0)).select("."+t).append("g").attr("class","graph-of-ave");for(var T=0;T<n.options.graphOfAvePoints;T++){E=0,y=0,m=u+T*w,g=u+(T+1)*w;for(var N=0;N<r.length;N++)T===n.options.graphOfAvePoints-1?r[N].x>=m&&r[N].x<=g&&(y+=1,E+=r[N].y):r[N].x>=m&&r[N].x<g&&(y+=1,E+=r[N].y);y>0&&(S=E/y,b={x:(m+g)/2,y:S},t==="plot-residual"&&(d=f-p*(a-b.x),v=S-d,b={x:(m+g)/2,y:S-d}),x.append("rect").attr("x",n.xScale(b.x)-2.5).attr("y",n.yScale(b.y)-2.5).attr("height",5).attr("width",5))}}},this.toggleSdLine=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c,h,p,d,v,m;n.container.find("svg g.sd-line").remove(),e&&(r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),s=mean(r),o=mean(i),f=sd(r),l=sd(i),c=corr(r,i),u=d3.max(r),a=d3.min(r),yMin=d3.min(i),yMax=d3.max(i),h=(c>=0?1:-1)*l/f,p={x:s,y:o},d={x:a,y:p.y-h*(p.x-a)},v={x:u,y:p.y-h*(p.x-u)},d.y<yMin&&(d.x=p.x-(p.y-yMin)/h,d.y=yMin),v.y<yMin&&(v.x=(yMin-p.y)/h+s,v.y=yMin),m=d3.select(n.chartDiv.get(0)).select(".plot-data").append("g").attr("class","sd-line"),m.append("line").attr("x1",n.xScale(d.x)).attr("x2",n.xScale(v.x)).attr("y1",n.yScale(d.y)).attr("y2",n.yScale(v.y)))},this.filterData=function(){var e=n.bottomControls["use-points"],t=n.currentData,r=t.length,i;return e?t:(i=$.grep(t,function(e,t){return e.added===!1}),i)},this.highlightDataPoint=function(e,t){var r=d3.select(n.chartDiv.get(0)).select('.data-point[data-index="'+e+'"]'),i=r.classed("selected"),s;t==="mouseover"?(r.node().parentNode.appendChild(r.node()),r.classed("active",!0).transition().duration(200).attr("r",5)):t==="mouseout"?r.classed("active",!1).transition().duration(200).attr("r",function(){return i?3.5:2}):t==="click"&&(s=!i,r.classed("selected",s),n.currentData[e].selected=s,n.container.find('.popbox.list-data tr[data-index="'+e+'"]').toggleClass("selected"))},this.plotMean=function(){var e=n.filterData(),t=$.map(e,function(e){return e.x}),r=$.map(e,function(e){return e.y}),i=mean(t),s=n.bottomControls["res-plot"]===!0?0:mean(r),o=n.xScale,u=n.yScale,a=5;d3.select(n.chartDiv.get(0)).select(".mean-point").remove(),d3.select(n.chartDiv.get(0)).select("svg .plot").append("rect").attr("x",o(i)-a/2).attr("y",u(s)-a/2).attr("class","mean-point").attr("width",a).attr("height",a).attr("fill","rgba(255, 0, 0, 1)").attr("stroke","#000")},this.toggleSds=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c;n.container.find("svg g.sds").remove(),e&&(u=$.map(t,function(e){return e.x}),a=$.map(t,function(e){return e.y}),r=mean(u),i=mean(a),s=sd(u),o=sd(a),f=[r-s,r+s],l=[i-o,i+o],c=d3.select(n.chartDiv.get(0)).select(".plot-data").append("g").attr("class","sds"),c.append("line").attr("x1",n.xScale(f[0])).attr("x2",n.xScale(f[0])).attr("y1",0).attr("y2",n.chartHeight-n.chartMargins.bottom-n.chartMargins.top),c.append("line").attr("x1",n.xScale(f[1])).attr("x2",n.xScale(f[1])).attr("y1",0).attr("y2",n.chartHeight-n.chartMargins.bottom-n.chartMargins.top),c.append("line").attr("x1",0).attr("x2",n.chartWidth-n.chartMargins.left-n.chartMargins.right).attr("y1",n.yScale(l[0])).attr("y2",n.yScale(l[0])),c.append("line").attr("x1",0).attr("x2",n.chartWidth-n.chartMargins.left-n.chartMargins.right).attr("y1",n.yScale(l[1])).attr("y2",n.yScale(l[1])))},$().ready(function(){}),o(),this.reloadData()}function mean(e){return vSum(e)/e.length}function vMult(e,t){var n=new Array(t.length);for(var r=0;r<t.length;r++)n[r]=e*t[r];return n}function vScalarSum(e,t){var n=new Array(e.length);for(var r=0;r<e.length;r++)n[r]=e[r]+t;return n}function vVectorSum(e,t){if(e.length!=t.length)return alert("Error #1 in irGrade.vVectorSum: vector lengths are not equal"),Math.NaN;var n=new Array(length(e));for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}function vPointwiseMult(e,t){var n=Math.NaN;if(e.length!=t.length)alert("Error #1 in irGrade.vPointwiseMult: vector lengths do not match!");else{n=new Array(e.length);for(var r=0;r<e.length;r++)n[r]=e[r]*t[r]}return n}function vFloor(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]=Math.floor(e[n]);return t}function vCeil(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]=Math.ceil(e[n]);return t}function vRoundToInts(e){var t=new Array(e.length),n;for(var r=0;r<e.length;r++)t[r]=Math.floor(e[r]),e[r]-t[r]>=.5&&t[r]++;return t}function vSum(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n];return t}function vProd(e){var t=1;for(var n=0;n<e.length;n++)t*=e[n];return t}function vCum(e){var t=e;for(var n=1;n<e.length;n++)t[n]+=t[n-1];return t}function vDiff(e){var t=new Array(e.length);for(var n=e.length-1;n>0;n--)t[n]=e[n]-e[n-1];return t[0]=e[0],t}function vInterval(e){var t=[];t[0]=e[0];for(var n=1;n<e.length;n++)t[n]=e[n]-e[n-1];return t}function vZero(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=0;return t}function vOne(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=1;return t}function twoNorm(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)}function convolve(e,t){var n=new Array(e.length+t.length-1),r,i;for(var s=0;s<e.length+t.length-1;s++){n[s]=0,i=Math.min(s+1,e.length),r=Math.max(0,s-t.length+1);for(var o=r;o<i;o++)n[s]+=e[o]*t[t.length-s-1+o]}return n}function nFoldConvolve(e,t){var n=e;for(var r=0;r<t;r++)n=convolve(n,e);return n}function numberLessThan(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?-1:n===0?0:1}function numberGreaterThan(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?1:n===0?0:-1}function sd(e){ave=mean(e),ssq=0;for(var t=0;t<e.length;t++)ssq+=(e[t]-ave)*(e[t]-ave);return ssq=Math.sqrt(ssq/e.length),ssq}function sampleSd(e){ave=mean(e),ssq=0;for(var t=0;t<e.length;t++)ssq+=(e[t]-ave)*(e[t]-ave);return ssq=Math.sqrt(ssq/(e.length-1)),ssq}function corr(e,t){if(e.length!=t.length)return alert("Error #1 in irGrade.corr(): lists have different lengths!"),Math.NaN;var n=mean(e),r=mean(t),i=sd(e),s=sd(t),o=0;for(var u=0;u<e.length;u++)o+=(e[u]-n)*(t[u]-r);return o/=i*s*e.length,o}function percentile(e,t){var n=e.length,r=e.slice(0);r.sort(numberLessThan);var i=Math.max(Math.ceil(t*n/100),1);return r[i-1]}function histMakeCounts(e,t){var n=e.length-1,r=new Array(n),i=0;for(i=0;i<n;i++)r[i]=0;for(i=0;i<t.length;i++){for(var s=0;s<n-1;s++)t[i]>=e[s]&&t[i]<e[s+1]&&(r[s]+=1);t[i]>=e[n-1]&&(r[n-1]+=1)}for(i=0;i<n;i++)r[i]/=t.length*(e[i+1]-e[i]);return r}function histMakeBins(e,t){binEnd=new Array(e+1),dMnMx=vMinMax(t);for(var n=0;n<e+1;n++)binEnd[n]=dMnMx[0]+n*(dMnMx[1]-dMnMx[0])/e;return binEnd}function histEstimatedPercentile(e,t,n){var r=e/100,i;if(r>1)i=Math.NaN;else if(r==1)i=t[nBins];else{var s=0,o=0;while(s<r)o++,s=histHiLitArea(t[0],t[o],t,n);o--,s=r-histHiLitArea(t[0],t[o],t,n);var u=histHiLitArea(t[o],t[o+1],t,n);i=t[o]+s/u*(t[o+1]-t[o])}return i}function histHiLitArea(e,t,n,r){var i=n.length-1,s=0;if(e<t)for(var o=0;o<i;o++)n[o]>t||n[o+1]<=e||(n[o]>=e&&n[o+1]<=t?s+=r[o]*(n[o+1]-n[o]):n[o]>=e&&n[o+1]>t?s+=r[o]*(t-n[o]):n[o]<=e&&n[o+1]<=t?s+=r[o]*(n[o+1]-e):n[o]<e&&n[o+1]>t&&(s+=r[o]*(t-e)));return s}function listOfRandSigns(e){var t=new Array(e);for(var n=0;n<e;n++){var r=rand.next();r<.5?t[n]=-1:t[n]=1}return t}function listOfRandUniforms(e,t,n){if(typeof t=="undefined"||t===null)t=0;if(typeof n=="undefined"||n===null)n=1;var r=new Array(e);for(var i=0;i<e;i++)r[i]=t+(n-t)*rand.next();return r}function listOfRandInts(e,t,n){var r=new Array(e);for(var i=0;i<e;i++)r[i]=Math.floor((n+1-t)*rand.next())+t;return r}function listOfDistinctRandInts(e,t,n){var r=new Array(e),i,s=0,o;while(s<e){i=Math.floor((n+1-t)*rand.next())+t,o=!0;for(var u=0;u<s;u++)i==r[u]&&(o=!1);o&&(r[s]=i,s++)}return r}function randomSample(e,t,n){var r=[],i=[];n!==null&&n?i=listOfRandInts(t,0,e.length-1):i=listOfDistinctRandInts(t,0,e.length-1);for(var s=0;s<t;s++)r[s]=e[i[s]];return r}function randomPartition(e,t){var n=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan);n[n.length]=e.length;var r=new Array(t),i=0;for(i=0;i<r.length;i++)r[i]=[];for(i=0;i<n[0];i++)r[0][i]=e[i];for(var s=1;s<t;s++)for(i=0;i<n[s]-n[s-1];i++)r[s][i]=e[n[s-1]+i];return r}function constrainedRandomPartition(e,t,n){if(t*n<e.length)return alert("Error in irGrade.constrainedRandomPartition: mx too small!"),!1;var r=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan);r[r.length]=e.length,vm=vMinMax(vDiff(r))[1];while(vm>n)r=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan),r[r.length]=e.length,vm=vMinMax(vDiff(r))[1];var i=new Array(t),s=0;for(s=0;s<i.length;s++)i[s]=[];for(s=0;s<r[0];s++)i[0][s]=e[s];for(var o=1;o<t;o++)for(s=0;s<r[o]-r[o-1];s++)i[o][s]=e[r[o-1]+s];return i}function multinomialSample(e,t){e=vMult(1/vSum(e),e);var n=vCum(e),r=vZero(e.length),i,s;for(var o=0;o<t;o++){i=rand.next(),s=0;while(i>n[s]&&s<t)s++;r[s]++}return r}function normPoints(e,t,n,r){var i=!0;if(typeof r=="undefined"||r===null)i=!1;var s=new Array(e),o=0;if(i)for(o=0;o<e;o++)s[o]=roundToDig(t+n*rNorm(),r);else for(o=0;o<e;o++)s[o]=t+n*rNorm();return s}function cNormPoints(e,t){var n=new Array(e),r=new Array(e),i;if(e==2)t==-1?(n[0]=-10,n[1]=10,r[0]=10,r[1]=-10):t===0?(n[0]=-10,n[1]=10,r[0]=0,r[1]=0):t==1?(n[0]=-10,n[1]=10,r[0]=-10,r[1]=10):(n[0]=Number.NaN,r[0]=Number.NaN);else if(e>2){for(i=0;i<e;i++)n[i]=rNorm(),r[i]=rNorm();var s=corr(n,r),o=sgn(s)*sgn(t),u=mean(n),a=mean(r),f=sd(n),l=sd(r),c=new Array(e),h=new Array(e);for(i=0;i<e;i++)n[i]=(n[i]-u)/f,c[i]=o*s*n[i]*l+a,h[i]=o*r[i]-c[i];var p=rms(h);for(i=0;i<e;i++)r[i]=Math.sqrt(1-t*t)*h[i]/p+t*n[i];var d=vMinMax(r),v=vMinMax(n),m=8.5/(v[1]-v[0]),g=8.5/(d[1]-d[0]);for(i=0;i<e;i++)n[i]=(n[i]-v[0])*m+1,r[i]=(r[i]-d[0])*g+1}else n[0]=Number.NaN,r[0]=Number.NaN;var y=new Array(n,r);return y}function listOfRandReals(e,t,n){var r=new Array(e);for(var i=0;i<e;i++)r[i]=(n-t)*rand.next()+t;return r}function rNorm(){var e=normInv(rand.next());return e}function normCdf(e){return.5*erfc(-e*.7071067811865475)}function erfc(e){var t=.46875,n=[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],r=[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],i=[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],s=[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],o=[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097],u=[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918],a,f,l,c,h,p,d=0;if(Math.abs(e)<=t){a=Math.abs(e),f=a*a,l=n[4]*f,c=f;for(d=0;d<3;d++)l=(l+n[d])*f,c=(c+r[d])*f;h=1-e*(l+n[3])/(c+r[3])}else if(Math.abs(e)<=4){a=Math.abs(e),l=i[8]*a,c=a;for(d=0;d<7;d++)l=(l+i[d])*a,c=(c+s[d])*a;h=(l+i[7])/(c+s[7]),a>0?f=Math.floor(a*16)/16:f=Math.ceil(a*16)/16,p=(a-f)*(a+f),h=Math.exp(-f*f)*Math.exp(-p)*h}else{a=Math.abs(e),f=1/(a*a),l=o[5]*f,c=f;for(d=0;d<4;d++)l=(l+o[d])*f,c=(c+u[d])*f;h=f*(l+o[4])/(c+u[4]),h=(1/Math.sqrt(Math.PI)-h)/a,a>0?f=Math.floor(a*16)/16:f=Math.ceil(a*16)/16,p=(a-f)*(a+f),h=Math.exp(-f*f)*Math.exp(-p)*h}return e<-t&&(h=2-h),h}function normInv(e){return e===0?Math.NEGATIVE_INFINITY:e>=1?Math.POSITIVE_INFINITY:Math.sqrt(2)*erfInv(2*e-1)}function erfInv(e){var t=[.886226899,-1.645349621,.914624893,-0.140543331],n=[-2.118377725,1.442710462,-0.329097515,.012229801],r=[-1.970840454,-1.624906493,3.429567803,1.641345311],i=[3.5438892,1.6370678],s=.7,o=0,u=0;return Math.abs(e)<=s?(u=e*e,o=e*(((t[3]*u+t[2])*u+t[1])*u+t[0])/((((n[3]*u+n[2])*u+n[1])*u+n[0])*u+1)):e>s&&e<1?(u=Math.sqrt(-Math.log((1-e)/2)),o=(((r[3]*u+r[2])*u+r[1])*u+r[0])/((i[1]*u+i[0])*u+1)):e<-s&&e>-1&&(u=Math.sqrt(-Math.log((1+e)/2)),o=-(((r[3]*u+r[2])*u+r[1])*u+r[0])/((i[1]*u+i[0])*u+1)),o-=(1-erfc(o)-e)/(2/Math.sqrt(Math.PI)*Math.exp(-o*o)),o-=(1-erfc(o)-e)/(2/Math.sqrt(Math.PI)*Math.exp(-o*o)),o}function betaCdf(e,t,n){return t<=0||n<=0?Math.NaN:e>=1?1:e>0?Math.min(incBeta(e,t,n),1):0}function betaPdf(e,t,n){return t<=0||n<=0||e<0||e>1?Math.NaN:e===0&&t<1||e==2&&n<1?Math.POSITIVE_INFINITY:t<=0||n<=0||e<=0||e>=1?0:Math.exp((t-1)*Math.log(e)+(n-1)*Math.log(1-e)-lnBeta(t,n))}function lnBeta(e,t){return lnGamma(e)+lnGamma(t)-lnGamma(e+t)}function betaInv(e,t,n){if(e<0||e>1||t<=0||n<=0)return Math.NaN;if(e===0)return Math.NEGATIVE_INFINITY;if(e==1)return Math.POSITIVE_INFINITY;var r=100,i=0,s=Math.sqrt(eps),o=1,u,a;t===0?a=Math.sqrt(eps):n===0?a=1-Math.sqrt(eps):a=t/(t+n);while(Math.abs(o)>s*Math.abs(a)&&Math.abs(o)>s&&i<r){i++,o=(betaCdf(a,t,n)-e)/betaPdf(a,t,n),u=a-o;while(u<0||u>1)o/=2,u=a-o;a=u}return a}function gammaPdf(e,t,n){var r=Math.NaN;return t<=0||n<=0?r=Math.NaN:e>0?r=Math.exp((t-1)*Math.log(e)-e/n-lnGamma(t)-t*Math.log(n)):e===0&&t<1?r=Math.POSITIVE_INFINITY:e===0&&t==1&&(r=1/n),r}function lnGamma(e){var t=-0.5772156649015329,n=[4.945235359296727,201.8112620856775,2290.8383738313464,11319.672059033808,28557.246356716354,38484.962284437934,26377.487876241954,7225.813979700288],r=[67.48212550303778,1113.3323938571993,7738.757056935398,27639.870744033407,54993.102062261576,61611.22180066002,36351.2759150194,8785.536302431014],i=.42278433509846713,s=[4.974607845568932,542.4138599891071,15506.93864978365,184793.29044456323,1088204.7694688288,3338152.96798703,5106661.678927353,3074109.0548505397],o=[183.03283993705926,7765.049321445006,133190.38279660742,1136705.8213219696,5267964.117437947,13467014.543111017,17827365.303532742,9533095.591844354],u=1.791759469228055,a=[14745.0216605994,2426813.3694867045,121475557.40450932,2663432449.630977,29403789566.34554,170266573776.5399,492612579337.7431,560625185622.3951],f=[2690.5301758708993,639388.5654300093,41355999.30241388,1120872109.616148,14886137286.788137,101680358627.24382,341747634550.73773,446315818741.9713],l=[-0.001910444077728,.00084171387781295,-0.0005952379913043012,.0007936507935003503,-0.0027777777777776816,.08333333333333333,.0057083835261],c=Math.NaN,h=1e-12,p=1,d=0,v,m,g,y=0;if(e<0)return c;if(e<=h)return-Math.log(e);if(e<=.5){for(y=0;y<8;y++)d=d*e+n[y],p=p*e+r[y];c=-Math.log(e)+e*(t+e*(d/p))}else if(e<=.6796875){v=e-1;for(y=0;y<8;y++)d=d*v+s[y],p=p*v+o[y];c=-Math.log(e)+v*(i+v*(d/p))}else if(e<=1.5){v=e-1;for(y=0;y<8;y++)d=d*v+n[y],p=p*v+r[y];c=v*(t+v*(d/p))}else if(e<=4){m=e-2;for(y=0;y<8;y++)d=d*m+s[y],p=p*m+o[y];c=m*(i+m*(d/p))}else if(e<=12){g=e-4,p=-1;for(y=0;y<8;y++)d=d*g+a[y],p=p*g+f[y];c=u+g*(d/p)}else{var b=l[6],w=e*e;for(y=0;y<6;y++)b=b/w+l[y];b/=e;var E=Math.log(e),S=.9189385332046728;c=b+S-.5*E+e*(E-1)}return c}function normPdf(e,t,n){return Math.exp(-(n-e)*(n-e)/(2*t*t))/(Math.sqrt(2*Math.PI)*t)}function tCdf(e,t){var n;return e<1?n=Math.NaN:t===0?n=.5:e==1?n=.5+Math.atan(t)/Math.PI:t>0?n=1-incBeta(e/(e+t*t),e/2,.5)/2:t<0&&(n=incBeta(e/(e+t*t),e/2,.5)/2),n}function tPdf(e,t){var n=Math.floor(e);return Math.exp(lnGamma((n+1)/2)-lnGamma(n/2))/(Math.sqrt(n*Math.PI)*Math.pow(1+t*t/n,(n+1)/2))}function tInv(e,t){var n;return t<0||e<0?Math.NaN:e===0?Math.NEGATIVE_INFINITY:e==1?Math.POSITIVE_INFINITY:t==1?Math.tan(Math.PI*(e-.5)):e>=.5?(n=betaInv(2*(1-e),t/2,.5),Math.sqrt(t/n-t)):(n=betaInv(2*e,t/2,.5),-Math.sqrt(t/n-t))}function incBeta(e,t,n){var r;if(e<0||e>1)r=Math.NaN;else{r=0;var i=Math.exp(lnGamma(t+n)-lnGamma(t)-lnGamma(n)+t*Math.log(e)+n*Math.log(1-e));e<(t+1)/(t+n+2)?r=i*betaGuts(e,t,n)/t:r=1-i*betaGuts(1-e,n,t)/n}return r}function betaGuts(e,t,n){var r=t+1,i=t-1,s=t+n,o=1,u=o,a=o,f=1-s*e/r,l=0,c=l,h=l,p=l,d=l,v=l,m=1,g;while(a-v>4*eps*Math.abs(a))g=2*m,l=m*(n-m)*e/((i+g)*(t+g)),h=a+l*o,d=f+l*u,l=-(t+m)*(s+m)*e/((t+g)*(r+g)),c=h+l*a,p=d+l*f,v=a,o=h/p,u=d/p,a=c/p,m==1&&(f=1),m++;return a}function chi2Cdf(e,t){var n=e==Math.floor(e)?gammaCdf(t,e/2,2):Number.NaN;return n}function chi2Pdf(e,t){return t<=0?0:gammaPdf(t,Math.floor(e)/2,2)}function chi2Inv(e,t){var n=Math.NaN;if(e===0)n=0;else if(e==1)n=Math.POSITIVE_INFINITY;else if(e<0)n=Math.NaN;else{var r=1e-8,i=.001;n=Math.max(0,t+Math.sqrt(2*t)*normInv(e));var s=chi2Cdf(n,t),o=s,u=s,a=n,f=n;while(o>e)a=.8*a,o=chi2Cdf(a,t);while(u<e)f=1.2*f,u=chi2Cdf(f,t);n=(a+f)/2,s=chi2Cdf(n,t);while(Math.abs(s-e)>r||Math.abs(s-e)/e>i)s<e?a=n:f=n,n=(a+f)/2,s=chi2Cdf(n,t)}return n}function gammaCdf(e,t,n){var r=Math.NaN;return t<=0||n<=0||(e<=0?r=0:r=Math.min(incGamma(e/n,t),1)),r}function incGamma(e,t){var n=0,r=lnGamma(t+rmin);if(e===0)n=0;else if(t===0)n=1;else if(e<t+1){var i=t,s=1/i,o=s;while(Math.abs(o)>=10*eps*Math.abs(s))o*=e/++i,s+=o;n=s*Math.exp(-e+t*Math.log(e)-r)}else if(e>=t+1){var u=1,a=e,f=0,l=1,c=1,h=1,p=1,d=0,v,m;while(Math.abs(p-d)>=10*eps*Math.abs(p))d=p,v=h-t,u=(a+u*v)*c,f=(l+f*v)*c,m=h*c,a=e*u+m*a,l=e*f+m*l,c=1/a,p=l*c,h++;n=1-Math.exp(-e+t*Math.log(e)-r)*p}return n}function poissonPmf(e,t){var n=0;return t!=Math.floor(t)?n=Number.NaN:t>=0&&(n=Math.exp(-e)*Math.pow(e,t)/factorial(t)),n}function poissonCdf(e,t){var n=0,r=0,i=0;if(t!=Math.floor(t))n=Number.NaN;else{while(i<=t)r+=Math.pow(e,i++)/factorial(t);n+=Math.exp(-e)*r}return n}function poissonTail(e,t){return 1-poissonCdf(e,t-1)}function expCdf(e,t){return 1-Math.exp(-t/e)}function expPdf(e,t){return 1/e*Math.exp(-t/e)}function factorial(e){var t=Number.NaN;if(e!=Math.floor(e))t=Number.NaN;else{t=1;for(var n=e;n>1;n--)t*=n}return Math.round(t)}function binomialCoef(e,t){if(e!=Math.floor(e)||t!=Math.floor(t))return Number.NaN;if(e<t||e<0)return 0;if(t===0||e===0||e==t)return 1;var n=Math.min(t,e-t),r=1;for(var i=0;i<n;i++)r*=(e-i)/(n-i);return Math.round(r)}function binomialPmf(e,t,n){var r=binomialCoef(e,n)*Math.pow(t,n)*Math.pow(1-t,e-n);return r}function binomialCdf(e,t,n){if(n<0)return 0;if(n>=e)return 1;var r=0;for(var i=0;i<=n;i++)r+=binomialPmf(e,t,i);return r}function binomialTail(e,t,n){if(n<0)return 1;if(n>=e)return 0;var r=0;for(var i=n;i<=e;i++)r+=binomialPmf(e,t,i);return r}function binomialInv(e,t,n){var r=0;if(n<0||n>1)r=NaN;else if(n===0)r=0;else if(n==1)r=e;else{r=0;var i=0;while(i<n)i+=binomialPmf(e,t,r++);r-=1}return r}function binomialLowerCL(e,t,n,r){p=t/e;if(t>0){f=binomialTail(e,p,t-1);while(f>=1-n)p-=r,f=binomialTail(e,p,t-1)}else p=0;return p}function multinomialCoef(e,t){var n=0,r=vMinMax(e);if(typeof t=="undefined"||t===null)t=vSum(e);if(r[0]<0)alert("Error #1 in irGrade.multinomialCoef: a number of outcomes is negative!");else if(t==vSum(e)){n=factorial(t);for(var i=0;i<e.length;i++)n/=factorial(e[i])}return n}function multinomialPmf(e,t,n){var r=0,i=vMinMax(t),s=vMinMax(e);if(typeof n=="undefined"||n===null)n=vSum(e);if(e.length!=t.length)alert("Error #1 in irGrade.multinomialPmf: length of outcome and probability vectors do not match!");else if(i[0]<0)alert("Error #2 in irGrade.multinomialPmf: a probability is negative!");else if(s[0]<0)alert("Error #3 in irGrade.multinomialPmf: a number of outcomes is negative!");else if(n==vSum(e)){var o=vMult(1/vSum(t),t);r=factorial(n);for(var u=0;u<e.length;u++)r*=Math.pow(o[u],e[u])/factorial(e[u])}return r}function geoPmf(e,t){var n=0;return t!=Math.floor(t)?n=Number.NaN:t<1||e===0?n=0:n=Math.pow(1-e,t-1)*e,n}function geoCdf(e,t){var n=0;return t!=Math.floor(t)?n=Number.NaN:t<1||e===0?n=0:n=1-Math.pow(1-e,t),n}function geoTail(e,t){return 1-geoCdf(e,t-1)}function geoInv(e,t){var n=0;if(t<0||t>1)n=Math.NaN;else if(t===0)n=0;else if(t==1)n=Math.POSITIVE_INFINITY;else{n=0;var r=0;while(r<t)r+=geoPmf(e,n++)}return n}function hyperGeoPmf(e,t,n,r){var i=0;return e!=Math.floor(e)||t!=Math.floor(t)||n!=Math.floor(n)||r!=Math.floor(r)?i=Number.NaN:n<r||e<t||t<r||r<0||e<0?i=0:i=binomialCoef(t,r)*binomialCoef(e-t,n-r)/binomialCoef(e,n),i}function hyperGeoCdf(e,t,n,r){var i=0;if(e!=Math.floor(e)||t!=Math.floor(t)||n!=Math.floor(n)||r!=Math.floor(r))i=Number.NaN;else{var s=Math.min(r,t);s=Math.min(s,n);for(var o=0;o<=s;o++)i+=hyperGeoPmf(e,t,n,o)}return i}function hyperGeoTail(e,t,n,r){var i=0;if(e!=Math.floor(e)||t!=Math.floor(t)||n!=Math.floor(n)||r!=Math.floor(r))i=Number.NaN;else for(var s=r;s<=Math.min(t,n);s++)i+=hyperGeoPmf(e,t,n,s);return i}function negBinomialPmf(e,t,n){var r=0;return t!=Math.floor(t)||n!=Math.floor(n)?r=Number.NaN:t>n||t<0?r=0:r=e*binomialPmf(n-1,e,t-1),r}function negBinomialCdf(e,t,n){var r=0;if(t!=Math.floor(t)||n!=Math.floor(n))r=Number.NaN;else for(var i=t;i<=n;i++)r+=negBinomialPmf(e,t,i);return r}function pDieRolls(e,t){if(e>4)return alert("Error #1 in irGrade.pDiceRolls: too many rolls "+e+". "),Math.NaN;var n=0;if(t<e||t>6*e)return 0;var r=Math.pow(6,e),i=0,s=0,o=0;if(e==1)return 1/r;if(e==2)for(i=1;i<=6;i++)for(s=1;s<=6;s++)i+s==t&&n++;else if(e==3)for(i=1;i<=6;i++)for(s=1;s<=6;s++)for(o=1;o<=6;o++)i+s+o==t&&n++;else if(e==4)for(i=1;i<=6;i++)for(s=1;s<=6;s++)for(o=1;o<=6;o++)for(var u=1;u<=6;u++)i+s+o+u==t&&n++;return n/r}function permutations(e,t){var n;if(Math.floor(e)!=e||Math.floor(t)!=t)n=Number.NaN;else if(e<t||e<0)n=0;else if(t===0||e===0)n=1;else{n=1;for(var r=0;r<t;r++)n*=e-r}return Math.round(n)}function sgn(e){if(e>=0)return 1;if(e<0)return-1}function linspace(e,t,n){var r=new Array(n),i=(t-e)/(n-1);for(var s=0;s<n;s++)r[s]=e+s*i;return r}function rms(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return t/=e.length,Math.sqrt(t)}function vMinMax(e){var t=e[0],n=e[0];for(var r=1;r<e.length;r++)t>e[r]&&(t=e[r]),n<e[r]&&(n=e[r]);var i=new Array(t,n);return i}function vMinMaxIndices(e){var t=e[0],n=0,r=e[0],i=0;for(var s=1;s<e.length;s++)t>e[s]&&(t=e[s],n=s),r<e[s]&&(r=e[s],i=s);var o=new Array(t,r,n,i);return o}function vMinMaxAbs(e){var t=Math.abs(e[0]),n=Math.abs(e[0]),r;for(var i=1;i<e.length;i++)r=Math.abs(e[i]),t>r&&(t=r),n<r&&(n=r);var s=new Array(t,n);return s}function randBoolean(e){if(typeof e=="undefined"||e===null)e=.5;return rand.next()<=e?!1:!0}function sortUnique(e,t){var n=e;typeof t!="undefined"&&t!==null?n.sort(t):n.sort();var r=[];r[0]=n[0];var i=0;for(var s=1;s<n.length;s++)n[s]!=r[i]&&(r[++i]=n[s]);return r}function uniqueCount(e){var t={};t[e[0]]=e[0];var n=0;for(n=1;n<e.length;n++)typeof t[e[n]]=="undefined"||t[e[n]]===null?t[e[n]]=1:t[e[n]]++;uc=new Array(2),uc[0]=[],uc[1]=[];var r=0;for(n in t)uc[0][r]=n,uc[1][r++]=t[n];return uc}function unique(e){return uniqueCount(e)[0]}function randPermutation(e,t){var n=listOfDistinctRandInts(e.length,0,e.length-1),r=new Array(e.length),i=0;for(i=0;i<e.length;i++)r[i]=e[n[i]];var s=0;if(typeof t!="undefined"&&t=="forward")s=new Array(2),s[0]=r,s[1]=n,r=s;else if(typeof t!="undefined"&&t=="inverse"){s=new Array(2),s[0]=r,s[1]=new Array(e.length);for(i=0;i<e.length;i++)s[1][n[i]]=i;r=s}return r}function cyclicPermutation(e,t){if(typeof t=="undefined"||t===null)t=1;var n=new Array(e);for(var r=0;r<e;r++)n[r]=(r+t)%e;return n}function distinctPermutation(e,t){if(typeof t=="undefined"||t===null)t=Math.min(3,e-1);return cyclicPermutation(e,t)}function distinctRandPermutation(e){function t(e){v=!1;for(var t=0;t<e.length;t++)e[t]==t&&(v=!0);return v}var n=new Array(e);for(var r=0;r<e;r++)n[r]=r;n=randPermutation(n);while(t(n))n=randPermutation(n);return n}function fakeBivariateData(e,t,n,r,i,s){var o=new Array(2);o[0]=new Array(e),o[1]=new Array(e),r===0&&(r=2);var u,a,f,l;if(t[0]!="polynomial")return alert("Error #1 in irGrade.fakeBivariateData()!\nUnsupported function type: "+t[0].toString()),null;if(typeof i=="undefined"||i===null)i=-10;if(typeof s=="undefined"||s===null)s=10;var c=(s-i)/(e-1);for(l=0;l<e;l++){u=i+l*c,o[0][l]=u,a=0,f=1;for(var h=1;h<t.length;h++)a+=f*t[h],f*=u;o[1][l]=a}var p=twoNorm(o[1]),d=new Array(e);for(l=0;l<e;l++)d[l]=rNorm();var v=Math.floor(e/3),m=Math.floor(2*e/3*rand.next());for(l=m;l<m+v;l++)d[l]=d[l]*n;var g=twoNorm(d);for(l=0;l<e;l++)o[1][l]+=d[l]*p/g/r;return o}function nextRand(){var e=this.seed/this.Q,t=this.seed%this.Q,n=this.A*t-this.R*e;return n>0?this.seed=n:this.seed=n+this.M,this.seed*this.oneOverM}function rng(e){if(typeof e=="undefined"||e===null){var t=new Date;this.seed=2345678901+t.getSeconds()*16777215+t.getMinutes()*65535}else this.seed=e;return this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.oneOverM=1/this.M,this.next=nextRand,this.getSeed=getRandSeed,this}function getRandSeed(){return this.seed}function crypt(e,t){var n=e.length,r=t.length,i=16,s=0,o,u=-1,a="";if(e.substr(0,2)=="0x")for(o=2;o<n;o+=2)++u>=r&&(u=0),s=parseInt(e.substr(o,2),i)^t.charCodeAt(u),a+=String.fromCharCode(s);else{a+="0x";for(o=0;o<n;o++)++u>=r&&(u=0),s=e.charCodeAt(o)^t.charCodeAt(u),a+=(s<i?"0":"")+s.toString(i)}return a}function statCalc(e,t){function r(){var e=$("<div />").addClass("calc");n.container.append(e),n.theDisplay=$('<input type="text" />').attr("size",n.options.digits),e.append(n.theDisplay),n.buttonDiv=$("<div />").addClass("buttonDiv"),n.numButtonDiv=$("<div />").addClass("numButtonDiv"),n.fnButtonDiv=$("<div />").addClass("fnButtonDiv"),n.numButtonTable=$("<table />").addClass("numButtonTable"),n.fnButtonTable=$("<table />").addClass("fnButtonTable"),n.numButtonDiv.append(n.numButtonTable),n.fnButtonDiv.append(n.fnButtonTable),n.buttonDiv.append(n.numButtonDiv),n.buttonDiv.append(n.fnButtonDiv),$.each(n.options.keys,function(e,t){var r=$("<tr>");n.numButtonTable.append(r),$.each(t,function(e,t){if(null===t){r.append($("<td/>"));return}newBut=$('<input type="button" value="'+t[0]+'">').button().addClass(t[1]).addClass("calcButton").click(function(e){e.preventDefault(),i(t[0],t[1])}),r.append($("<td/>").append(newBut))})}),e.append(n.buttonDiv)}function i(e,t){var r=n.theDisplay.val().replace(/[^0-9e.\-]+/gi,"").replace(/^0+/,"");try{switch(t){case"num":n.theDisplay.val(r+e);break;case"una":switch(e){case"+/-":r=r.indexOf("-")===0?r.substring(1):"-"+r,n.theDisplay.val(r);break;case"!":n.theDisplay.val(factorial(r).toString());break;case"Sqrt":n.theDisplay.val(Math.sqrt(r).toString());break;case"x^2":n.theDisplay.val((r*r).toString());break;case"exp(x)":n.theDisplay.val(Math.exp(r).toString());break;case"ln(x)":n.theDisplay.val(Math.log(r).toString());break;case"1/x":n.theDisplay.val((1/r).toString());break;case"U[0,1]":n.theDisplay.val(rand.next());break;case"N(0,1)":n.theDisplay.val(rNorm());break;case"CE":n.theDisplay.val("0");break;case"C":n.x=0,n.inProgress=!1,n.currentOp=null,n.theDisplay.val("0")}break;case"bin":n.inProgress?(n.x=s(n.x,n.currentOp,r),n.theDisplay.val(n.x.toString())):(n.x=r,n.theDisplay.val("?"),n.inProgress=!0),n.currentOp=e;break;case"eq":n.inProgress&&(n.x=s(n.x,n.currentOp,r),n.theDisplay.val(n.x.toString()),n.inProgress=!1,n.currentOp=null);break;default:console.log("unexpected button in statCalc "+e)}}catch(i){console.log(i),n.theDisplay.val("NaN")}}function s(e,t,n){var r=Math.NaN;try{switch(t){case"+":r=parseFloat(e)+parseFloat(n);break;case"-":r=parseFloat(e)-parseFloat(n);break;case"*":r=parseFloat(e)*parseFloat(n);break;case"/":r=parseFloat(e)/parseFloat(n);break;case"x^y":r=parseFloat(e)^parseFloat(n);break;case"nCk":r=binomialCoef(parseFloat(e),parseFloat(n));break;case"nPk":r=permutations(parseFloat(e),parseFloat(n));break;default:console.log("unexpected binary function in statCalc "+t)}}catch(i){}return r}var n=this;this.container=$("#"+e);if(!t instanceof Object){console.error("statCalc parameters should be an object");return}this.options={keys:[[["7","num"],["8","num"],["9","num"],["/","bin"],["nCk","bin"]],[["4","num"],["5","num"],["6","num"],["*","bin"],["nPk","bin"]],[["1","num"],["2","num"],["3","num"],["-","bin"],["!","una"]],[["0","num"],[".","num"],["+/-","una"],["+","bin"],["1/x","una"]],[["=","eq"],["CE","una"],["C","una"],["Sqrt","una"],["x^2","una"]]],buttonsPerRow:5,digits:16},$.extend(this.options,t),n.x=0,n.inProgress=!1,n.currentOp=null,r()}function distCalc(e,t){function i(){var e=$("<div />").addClass("distCalc");n.container.append(e),n.selectDiv=$("<div />").addClass("selectDiv").append("If X has a "),n.selectDist=$("<select />").change(function(){s($(this).val())}),$.each(n.options.distributions,function(e,t){$("<option/>",{value:t[0]}).text(t[0]).appendTo(n.selectDist),n.distDivs[t[0]]=$("<div />").css("display","inline"),$.each(t[1],function(e,r){n.distDivs[t[0]].append(r+" = ").append($('<input type="text" />').attr("size","paramDigits").addClass(r.replace(/ +/g,"_")).blur(o)).append(", ")})}),n.paramSpan=$("<span />").addClass("paramSpan"),n.selectDiv.append(n.selectDist).append("distribution with ").append(n.paramSpan),n.currDist=n.options.distributions[0][0],n.paramSpan.append(n.distDivs[n.currDist]),n.selectDiv.append(" the chance that ").append($('<input type="checkbox">').addClass("useLower").click(o)).append("X &ge;").append($('<input type="text" />').addClass("loLim").attr("size",n.options.digits).val("0").blur(o)).append($('<input type="checkbox">').addClass("useUpper").click(o)).append("and X &le;").append($('<input type="text" />').addClass("hiLim").attr("size",n.options.digits).val("0").blur(o)).append(" is "),n.theDisplay=$('<input type="text" readonly />').attr("size",n.options.digits+4),n.expectSpan=$("<span />").addClass("expectSpan"),n.selectDiv.append(n.theDisplay).append(n.expectSpan),e.append(n.selectDiv)}function s(e){n.currDist=e,n.paramSpan.empty(),n.expectSpan.empty();var t=$.grep(n.options.distributions,function(t,n){return t[0]===e});n.paramSpan.append(n.distDivs[t[0][0]]),n.theDisplay.val("NaN"),o()}function o(e){typeof e!="undefined"&&e instanceof jQuery.Event&&e.preventDefault();var t=Number.NaN,i=n.selectDiv.find(".useLower").prop("checked"),s=i?parseFloat(n.selectDiv.find(".loLim").val()):Number.NaN,o=n.selectDiv.find(".useUpper").prop("checked"),u=o?parseFloat(n.selectDiv.find(".hiLim").val()):Number.NaN,a=!0;$.each(n.distDivs[n.currDist].find(":input"),function(e,t){t.value.trim().length===0&&(a=!1)});if(!i&&!o||!a)t=Number.NaN;else if(i&&o&&s>u)t=0;else{n.expectSpan.empty();var f,l,c,h,p,d;switch(n.currDist){case"Binomial":f=parseFloat(n.distDivs[n.currDist].find(".n").val()),l=parsePercent(n.distDivs[n.currDist].find(".p").val()),c=o?binomialCdf(f,l,u):1,h=i?binomialCdf(f,l,s-1):0,t=c-h,n.options.showExpect&&n.expectSpan.append("E(X) = "+(f*l).toFixed(n.options.paramDigits)+"; SE(X) = "+Math.sqrt(f*l*(1-l)).toFixed(n.options.paramDigits));break;case"Geometric":l=parsePercent(n.distDivs[n.currDist].find(".p").val()),c=o?geoCdf(l,u):1,h=i?geoCdf(l,s-1):0,n.options.showExpect&&n.expectSpan.append("E(X) = "+(1/l).toFixed(n.options.paramDigits)+"; SE(X) = "+(Math.sqrt(1-l)/l).toFixed(n.options.paramDigits)),t=c-h;break;case"Negative Binomial":l=parsePercent(n.distDivs[n.currDist].find(".p").val()),r=parseFloat(n.distDivs[n.currDist].find(".r").val()),c=o?negBinomialCdf(l,r,u):1,h=i?negBinomialCdf(l,r,s-1):0,t=c-h,n.options.showExpect&&n.expectSpan.append("E(X) = "+(r/l).toFixed(n.options.paramDigits)+"; SE(X) = "+(Math.sqrt(r*(1-l))/l).toFixed(n.options.paramDigits));break;case"Hypergeometric":var v=parseFloat(n.distDivs[n.currDist].find(".N").val()),m=parseFloat(n.distDivs[n.currDist].find(".G").val());f=parseFloat(n.distDivs[n.currDist].find(".n").val()),c=o?hyperGeoCdf(v,m,f,u):1,h=i?hyperGeoCdf(v,m,f,s-1):0,t=c-h;var g=m/v;n.options.showExpect&&n.expectSpan.append("E(X) = "+(f*g).toFixed(n.options.paramDigits)+"; SE(X) = "+Math.sqrt(f*g*(1-g)*(v-f)/(v-1)).toFixed(n.options.paramDigits));break;case"Normal":d=parseFloat(n.distDivs[n.currDist].find(".mean").val());var y=parseFloat(n.distDivs[n.currDist].find(".SD").val());c=o?normCdf((u-d)/y):1,h=i?normCdf((s-d)/y):0,t=c-h,n.options.showExpect&&n.expectSpan.append("E(X) = "+d.toFixed(n.options.paramDigits)+"; SE(X) = "+y.toFixed(n.options.paramDigits));break;case"Student t":p=parseFloat(n.distDivs[n.currDist].find(".degrees_of_freedom").val()),c=o?tCdf(p,u):1,h=i?tCdf(p,s):0,t=c-h;var b=p>2?Math.sqrt(p/(p-2)).toFixed(n.options.paramDigits):Number.NaN;n.options.showExpect&&n.expectSpan.append("E(X) = 0; SE(X) = "+b);break;case"Chi-square":p=parseFloat(n.distDivs[n.currDist].find(".degrees_of_freedom").val()),c=o?chi2Cdf(p,u):1,h=i?chi2Cdf(p,s):0,n.options.showExpect&&n.expectSpan.append("E(X) = "+p.toFixed(n.options.paramDigits)+"; SE(X) = "+Math.sqrt(2*p).toFixed(n.options.paramDigits)),t=c-h;break;case"Exponential":d=parseFloat(n.distDivs[n.currDist].find(".mean").val()),c=o?expCdf(d,u):1,h=i?expCdf(d,s):0,t=c-h,n.options.showExpect&&n.expectSpan.append("E(X) = "+d.toFixed(n.options.paramDigits)+"; SE(X) = "+d.toFixed(n.options.paramDigits));break;case"Poisson":d=parseFloat(n.distDivs[n.currDist].find(".mean").val()),c=o?poissonCdf(d,u):1,h=i?poissonCdf(d,s):0,t=c-h,n.options.showExpect&&n.expectSpan.append("E(X) = "+d.toFixed(n.options.paramDigits)+"; SE(X) = "+Math.sqrt(d).toFixed(n.options.paramDigits));break;default:console.log("unexpected distribution in distCalc.calcProb "+dist)}}n.theDisplay.val((100*t).toFixed(n.options.digits-3)+"%")}var n=this;this.container=$("#"+e);if(!t instanceof Object){console.error("distCalc parameters should be an object");return}this.options={distributions:[["Binomial",["n","p"]],["Geometric",["p"]],["Negative Binomial",["p","r"]],["Hypergeometric",["N","G","n"]],["Normal",["mean","SD"]],["Student t",["degrees of freedom"]],["Chi-square",["degrees of freedom"]],["Exponential",["mean"]],["Poisson",["mean"]]],digits:8,paramDigits:4,showExpect:!0},$.extend(this.options,t),n.lo=0,n.hi=0,n.currDist=null,n.distDivs=[],i()}function Stici_Venn(e,t){function v(t,n){var r=jQuery("<div/>",{id:e+"psb"+t}).addClass("scrollbar"),i=jQuery("<label/>").attr("for",e+"sb"+t);i.html("P("+t+") (%)");var o=function(){$("#"+e+"sb"+t).slider("value",this.value),y()},u=function(){$("#"+e+"sb"+t+"t").val($(this).slider("value")),y()},a=jQuery("<input/>",{type:"text",id:e+"sb"+t+"t",change:o,value:n,size:2}),f=jQuery("<span/>").addClass("slider").attr("id",e+"sb"+t).slider({change:u,slide:u,min:1,max:100,step:1,value:n});r.append(i),r.append(a),r.append(f),s.append(r)}function g(){function t(e){var t=e.offset().left+e.width()-(o.offset().left+o.width());t>0&&e.css("left",e.position().left-t+"px");var n=e.offset().top+e.height()-(o.offset().top+o.height());n>0&&e.css("top",e.position().top-n+"px"),e.position().left<o.position().left&&e.css("left",o.position().left+"px"),e.position().top<o.position().top&&e.css("top",o.position().top+"px")}function n(e,t,n){var r=e.position().left,i=e.position().top,s=e.width(),o=e.height(),u=t.position().left,a=t.position().top,f=t.width(),l=t.height();if(r+s<u||u+f<r||i+o<a||a+l<i)n.css("display","none");else{n.css("display","");var c=Math.max(r,u),h=Math.max(i,a);n.css("left",c+"px"),n.css("top",h+"px");var p=Math.min(r+s,u+f),d=Math.min(i+o,a+l);n.css("width",p-c+"px"),n.css("height",d-h+"px")}}t(u),t(a),f.css("left",u.css("left")),f.css("top",u.css("top")),f.css("width",u.css("width")),f.css("height",u.css("height")),l.css("left",a.css("left")),l.css("top",a.css("top")),l.css("width",a.css("width")),l.css("height",a.css("height")),n(u,a,c);var r=o.width()*o.height(),i=f.width()*f.height()/r*100,s=l.width()*l.height()/r*100,d=c.width()*c.height()/r*100,v=i+s-d;if(c.position().left==u.position().left&&c.position().top==u.position().top&&c.width()==u.width()&&c.height()==u.height()||c.position().left==a.position().left&&c.position().top==a.position().top&&c.width()==a.width()&&c.height()==a.height())d=Math.min($("#"+e+"sbA").slider("value"),$("#"+e+"sbB").slider("value")),v=Math.max($("#"+e+"sbA").slider("value"),$("#"+e+"sbB").slider("value"));c.css("display")=="none"&&(d=0,v=parseFloat($("#"+e+"sbA").slider("value"))+parseFloat($("#"+e+"sbB").slider("value"))),h.text("P(AB): "+d.fix(1)+"%"),p.text("P(A or B): "+v.fix(1)+"%")}function y(){var t=o.width()/o.height(),n=o.width()*o.height(),r=$("#"+e+"sbA").slider("value")/100,i=n*r,s=Math.sqrt(i*t),f=i/s;u.width(s+"px"),u.height(f+"px");var l=$("#"+e+"sbB").slider("value")/100,c=n*l,h=Math.sqrt(c*t),p=c/h;a.width(h+"px"),a.height(p+"px"),g()}function b(){var e=.3,t=.3;o=jQuery("<div/>").addClass("box").addClass("S"),o.css("left","10px"),o.css("top","10px"),o.css("width",n.container.width()-20+"px"),o.css("height",n.container.height()-20+"px"),o.text("S"),n.container.append(o);var r=n.container.width()/2-50,i=n.container.height()/2-25;f=jQuery("<div/>").addClass("box").addClass("A").addClass("fill"),u=jQuery("<div/>").addClass("box").addClass("A").addClass("outline"),u.css("left",r-32+"px"),u.css("top",i-16+"px"),u.css("width",o.width()*e+"px"),u.css("height",o.height()*t+"px"),u.text("A"),l=jQuery("<div/>").addClass("box").addClass("B").addClass("fill"),a=jQuery("<div/>").addClass("box").addClass("B").addClass("outline"),a.css("left",r+32+"px"),a.css("top",i+16+"px"),a.css("width",o.width()*e+"px"),a.css("height",o.height()*t+"px"),a.text("B"),c=jQuery("<div/>").addClass("box").addClass("AB").addClass("fill"),n.container.append(f),n.container.append(l),n.container.append(c),n.container.append(u),n.container.append(a),u.draggable({containment:o,drag:g,stop:g}),a.draggable({containment:o,drag:g,stop:g})}var n=this;this.env=jQuery("#"+e);var r=jQuery("<div/>",{id:e+"app"}).addClass("stici_venn").addClass("stici");this.env.append(r),this.container=jQuery("<div/>",{id:e+"container"}).addClass("container");var i=jQuery("<div/>",{id:e+"buttons"}).addClass("buttons"),s=jQuery("<div/>",{id:e+"scrollbars"}).addClass("scrollbars");r.append(n.container),r.append(i),r.append(s),this.container.css("width",this.env.width()-i.width()+"px"),this.container.css("height",this.env.height()-s.height()+"px");var o,u,a,f,l,c,h,p;b();var d=[[{label:"A",filled:f},{label:"Ac",filled:o,opaque:f}],[{label:"B",filled:l},{label:"Bc",filled:o,opaque:l}],[{label:"A or B",filled:[f,l]},{label:"AB",filled:c}],[{label:"ABc",filled:f,opaque:c},{label:"AcB",filled:l,opaque:c}],[{label:"S",filled:o},{label:"{}"}]];$.each(d,function(e,t){var n=jQuery("<div/>").addClass("button_row");$.each(t,function(e,t){t.label=t.label.replace("c","<sup>c</sup>"),t.label=t.label.replace("|","&nbsp;|&nbsp;");var r=jQuery("<div/>").addClass("button");n.append(r);var i=jQuery("<input/>",{type:"radio",name:"buttons"}),s=jQuery("<label/>").click(function(){i.prop("checked",!0)});r.click(function(){i.prop("checked",!0),u.removeClass("selected opaque"),a.removeClass("selected opaque"),f.removeClass("selected opaque"),l.removeClass("selected opaque"),c.removeClass("selected opaque"),o.removeClass("selected opaque"),t.opaque!==undefined&&(!t.opaque instanceof Array&&(t.opaque=[t.opaque]),$.each(t.opaque,function(e,t){jQuery(t).addClass("opaque")})),t.filled!==undefined&&(!t.filled instanceof Array&&(t.filled=[t.filled]),$.each(t.filled,function(e,t){jQuery(t).addClass("selected")}))}),s.html(t.label),r.append(i),r.append(s)}),i.append(n)}),v("A",30),v("B",20);var m=jQuery("<div/>").addClass("info");h=jQuery("<p/>"),p=jQuery("<p/>"),m.append(h).append(p),s.append(m),y()}function Stici_Venn3(e,t){function w(t,n){var r=jQuery("<div/>",{id:e+"psb"+t}).addClass("scrollbar"),i=jQuery("<label/>").attr("for",e+"sb"+t);i.html("P("+t+") (%)");var o=function(){$("#"+e+"sb"+t).slider("value",this.value),x()},u=function(){$("#"+e+"sb"+t+"t").val($(this).slider("value")),x()},a=jQuery("<input/>",{type:"text",id:e+"sb"+t+"t",change:o,value:n,size:2}),f=jQuery("<span/>").addClass("slider").attr("id",e+"sb"+t).slider({change:u,slide:u,min:1,max:100,step:1,value:n});r.append(i),r.append(a),r.append(f),s.append(r)}function S(){function t(e){var t=e.offset().left+e.width()-(o.offset().left+o.width());t>0&&e.css("left",e.position().left-t+"px");var n=e.offset().top+e.height()-(o.offset().top+o.height());n>0&&e.css("top",e.position().top-n+"px"),e.position().left<o.position().left&&e.css("left",o.position().left+"px"),e.position().top<o.position().top&&e.css("top",o.position().top+"px")}function n(e,t,n){var r=e.position().left,i=e.position().top,s=e.width(),o=e.height(),u=t.position().left,a=t.position().top,f=t.width(),l=t.height();if(r+s<u||u+f<r||i+o<a||a+l<i)n.css("display","none");else{n.css("display","");var c=Math.max(r,u),h=Math.max(i,a);n.css("left",c+"px"),n.css("top",h+"px");var p=Math.min(r+s,u+f),d=Math.min(i+o,a+l);n.css("width",p-c+"px"),n.css("height",d-h+"px")}}t(u),t(a),t(f),l.css("left",u.css("left")),l.css("top",u.css("top")),l.css("width",u.css("width")),l.css("height",u.css("height")),c.css("left",a.css("left")),c.css("top",a.css("top")),c.css("width",a.css("width")),c.css("height",a.css("height")),h.css("left",f.css("left")),h.css("top",f.css("top")),h.css("width",f.css("width")),h.css("height",f.css("height")),n(u,a,p),n(a,f,v),n(u,f,d),n(p,v,m);var r=o.width()*o.height(),i=l.width()*l.height()/r*100,s=c.width()*c.height()/r*100,b=p.width()*p.height()/r*100,w=i+s-b;if(p.position().left==u.position().left&&p.position().top==u.position().top&&p.width()==u.width()&&p.height()==u.height()||p.position().left==a.position().left&&p.position().top==a.position().top&&p.width()==a.width()&&p.height()==a.height())b=Math.min($("#"+e+"sbA").slider("value"),$("#"+e+"sbB").slider("value")),w=Math.max($("#"+e+"sbA").slider("value"),$("#"+e+"sbB").slider("value"));p.css("display")=="none"&&(b=0,w=parseFloat($("#"+e+"sbA").slider("value"))+parseFloat($("#"+e+"sbB").slider("value"))),g.text("P(AB): "+b.fix(1)+"%"),y.text("P(A or B): "+w.fix(1)+"%")}function x(){var t=o.width()/o.height(),n=o.width()*o.height(),r=$("#"+e+"sbA").slider("value")/100,i=n*r,s=Math.sqrt(i*t),l=i/s;u.width(s+"px"),u.height(l+"px");var c=$("#"+e+"sbB").slider("value")/100,h=n*c,p=Math.sqrt(h*t),d=h/p;a.width(p+"px"),a.height(d+"px");var v=$("#"+e+"sbC").slider("value")/100,m=n*v,g=Math.sqrt(m*t),y=m/g;f.width(g+"px"),f.height(y+"px"),S()}function T(){var e=.3,t=.3;o=jQuery("<div/>").addClass("box").addClass("S"),o.css("left","10px"),o.css("top","10px"),o.css("width",n.container.width()-20+"px"),o.css("height",n.container.height()-20+"px"),o.text("S"),n.container.append(o),l=jQuery("<div/>").addClass("box").addClass("A").addClass("fill"),u=jQuery("<div/>").addClass("box").addClass("A").addClass("outline"),u.css("left",n.container.width()*.15+"px"),u.css("top",n.container.height()*.3+"px"),u.css("width",o.width()*e+"px"),u.css("height",o.height()*t+"px"),u.text("A"),c=jQuery("<div/>").addClass("box").addClass("B").addClass("fill"),a=jQuery("<div/>").addClass("box").addClass("B").addClass("outline"),a.css("left",n.container.width()*.5+"px"),a.css("top",n.container.height()*.4+"px"),a.css("width",o.width()*e+"px"),a.css("height",o.height()*t+"px"),a.text("B"),h=jQuery("<div/>").addClass("box").addClass("C").addClass("fill"),f=jQuery("<div/>").addClass("box").addClass("C").addClass("outline"),f.css("left",n.container.width()*.4+"px"),f.css("top",n.container.height()*.2+"px"),f.css("width",o.width()*e+"px"),f.css("height",o.height()*t+"px"),f.text("C"),p=jQuery("<div/>").addClass("box").addClass("AB").addClass("fill"),d=jQuery("<div/>").addClass("box").addClass("AC").addClass("fill"),v=jQuery("<div/>").addClass("box").addClass("BC").addClass("fill"),m=jQuery("<div/>").addClass("box").addClass("BC").addClass("fill"),n.container.append(l),n.container.append(c),n.container.append(h),n.container.append(p),n.container.append(d),n.container.append(v),n.container.append(m),n.container.append(u),n.container.append(a),n.container.append(f),u.draggable({containment:o,drag:S,stop:S}),a.draggable({containment:o,drag:S,stop:S}),f.draggable({containment:o,drag:S,stop:S})}var n=this;this.env=jQuery("#"+e);var r=jQuery("<div/>",{id:e+"app"}).addClass("stici_venn").addClass("stici_venn3").addClass("stici");this.env.append(r),this.container=jQuery("<div/>",{id:e+"container"}).addClass("container");var i=jQuery("<div/>",{id:e+"buttons"}).addClass("buttons"),s=jQuery("<div/>",{id:e+"scrollbars"}).addClass("scrollbars");r.append(n.container),r.append(i),r.append(s),this.container.css("width",this.env.width()-i.width()+"px"),this.container.css("height",this.env.height()-s.height()+"px");var o,u,a,f,l,c,h,p,d,v,m,g,y;T();var b=[[{label:"A",filled:l},{label:"B",filled:c},{label:"C",filled:h},{label:"Ac",filled:o,opaque:l}],[{label:"Bc",filled:o,opaque:c},{label:"Cc",filled:o,opaque:h},{label:"AB",filled:p},{label:"AC",filled:d}],[{label:"BC",filled:v},{label:"A or B",filled:[l,c]},{label:"A or C",filled:[l,h]},{label:"B or C",filled:[c,h]}],[{label:"ABC",filled:m},{label:"A or B or C",filled:[l,c,h]},{label:"ABc",filled:l,opaque:p},{label:"AcB",filled:c,opaque:p}],[{label:"AcBC",filled:v,opaque:m},{label:"Ac or BC",filled:[v,o],opaque:l},{label:"S",filled:o},{label:"{}"}],[{label:"P(A|B)",filled:c,hilite:p},{label:"P(Ac|B)",filled:p,hilite:c},{label:"P(B|A)",filled:l,hilite:p}],[{label:"P(A|BC)",filled:v,hilite:m},{label:"P(Ac|BC)",filled:m,hilite:v},{label:"P(A|(B or C))",filled:[c,h],hilite:[p,d]}]];$.each(b,function(e,t){var n=jQuery("<div/>").addClass("button_row");$.each(t,function(e,t){t.label=t.label.replace("c","<sup>c</sup>"),t.label=t.label.replace("|","&nbsp;|&nbsp;");var r=jQuery("<div/>").addClass("button");n.append(r);var i=jQuery("<input/>",{type:"radio",name:"buttons"}),s=jQuery("<label/>").click(function(){i.prop("checked",!0)});r.click(function(){i.prop("checked",!0),u.removeClass("selected opaque hilite"),a.removeClass("selected opaque hilite"),f.removeClass("selected opaque hilite"),l.removeClass("selected opaque hilite"),c.removeClass("selected opaque hilite"),h.removeClass("selected opaque hilite"),p.removeClass("selected opaque hilite"),v.removeClass("selected opaque hilite"),d.removeClass("selected opaque hilite"),m.removeClass("selected opaque hilite"),o.removeClass("selected opaque hilite"),t.opaque!==undefined&&(!t.opaque instanceof Array&&(t.opaque=[t.opaque]),$.each(t.opaque,function(e,t){jQuery(t).addClass("opaque")})),t.filled!==undefined&&(!t.filled instanceof Array&&(t.filled=[t.filled]),$.each(t.filled,function(e,t){jQuery(t).addClass("selected")})),t.hilite!==undefined&&(!t.hilite instanceof Array&&(t.hilite=[t.hilite]),$.each(t.hilite,function(e,t){jQuery(t).addClass("hilite")}))}),s.html(t.label),r.append(i),r.append(s)}),i.append(n)}),w("A",30),w("B",20),w("C",10);var E=jQuery("<div/>").addClass("info");g=jQuery("<p/>"),y=jQuery("<p/>"),E.append(g).append(y),x()}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Number.prototype.fix=function(e){return parseFloat(this.toFixed(e))};var rmin=2.3e-308,eps=2.3e-16;jQuery(function(){typeof rand=="undefined"?(console.log("rand has not been defined already, creating in stat_utils"),rand=rng()):console.log("Skipping creation of rand because it already exists.")}),function(){$.fn.popbox=function(e){var t=$.extend({selector:this.selector,open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close"},e),n={open:function(e){e.preventDefault();var r=$(this),i=$(this).parent().find(t.box);i.find(t.arrow).css({left:i.width()/2-10}),i.find(t.arrow_border).css({left:i.width()/2-10}),i.css("display")=="block"?n.close():i.css({display:"block",top:10,left:r.parent().width()/2-i.width()/2}),typeof $(this).parent().data("onPopBox")!="undefined"&&$(this).parent().data("onPopBox")()},close:function(){$(t.selector).find(t.box).fadeOut("fast")}};return $(document).bind("keyup",function(e){e.keyCode==27&&n.close()}),$(document).bind("click",function(e){$(e.target).closest(t.selector).length||n.close()}),this.each(function(){if($(this).data("isPopBox")===!0)return;$(this).data("isPopBox",!0),$(this).css("width")||$(this).css({width:$(t.box).width()}),$(t.open,this).bind("click",n.open),$(t.open,this).parent().find(t.close).bind("click",function(e){e.preventDefault(),n.close()})})}}.call(this);